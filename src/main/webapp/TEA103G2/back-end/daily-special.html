<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>嗜甜-商品管理-每日優惠商品</title>

  <!-- Favicon -->
  <link rel="shortcut icon" href="assets/images/favicon.ico"/>
  <link rel="stylesheet" href="assets/css/backend-plugin.min.css">
  <link rel="stylesheet" href="assets/css/backend.css?v=1.0.0">
  <link rel="stylesheet" href="assets/vendor/@fortawesome/fontawesome-free/css/all.min.css">
  <link rel="stylesheet" href="assets/vendor/line-awesome/dist/line-awesome/css/line-awesome.min.css">
  <link rel="stylesheet" href="assets/vendor/remixicon/fonts/remixicon.css">
  
  
  <style>
   thead.bg-white{
   	text-align:center;
   }
   tbody.ligth-body{
   	white-space: nowrap;
   	text-align:center;
   }
   
/*   燈箱 開始  */
   @media (min-width: 576px){
          .modal-dialog{
              max-width: 1000px !important;
          }
      }
      
	/*更新燈箱的照片預覽*/
	.database_image_wrapper{
		display: flex; 
 		flex-direction: row; 
	}


  	.database_image{
  		width: 150px;
  		height: 150px;
  		padding: 3px;
  	}    
   
/*   燈箱 結束  */

 	.discount_pause {
          height: 100px !important;
          margin-bottom: 12px;
    }
  
  </style>
  
  
  
</head>
<body class="  ">
<!-- loader Start -->
<div id="loading">
  <div id="loading-center">
  </div>
</div>
<!-- loader END -->
<!-- Wrapper Start -->
<div class="wrapper">


<!--Header-->
  <div class="header"></div>
	
  <div class="content-page">
    <div class="container-fluid">
      <div class="row">
        <div class="col-lg-12">
          <div class="d-flex flex-wrap flex-wrap align-items-center justify-content-between mb-4">
            <div>
              <h4 class="mb-3">每日優惠 - 商品列表</h4>
            </div>
            <a href="add-product.html" class="btn btn-primary add-daily-special-button" data-toggle="modal" data-target="#add-daily-special">
            <i class="las la-plus mr-3"></i>新增優惠商品</a>
          </div>
        </div>
        <!-- Table的地方 --><!--  一個tr為一列 -->
        <div class="col-lg-12">
          <div class="table-responsive rounded mb-3">
            <table class="data-table table mb-0 tbl-server-info">
              <thead class="bg-white text-uppercase">
              <tr class="ligth ligth-data">
                <th>優惠編號</th>
                <th>商品照片</th>
                <th>商品名稱</th>
                <th>商品編號</th>
                <th>子分類</th>
                <th>原始售價</th>
                <th>優惠價格</th>
                <th>開始日期</th>
                <th>結束日期</th>
                <th>商品狀態</th>
                <th>優惠狀態</th>
                <th>動作</th>
              </tr>
              </thead>
              <tbody class="ligth-body">
              <!-- 商品插入的位置 -->
<!--                                       <tr> -->
<!--                                           <td> -->
<!--                                               <div class="checkbox d-inline-block"> -->
<!--                                                   <input type="checkbox" class="checkbox-input" id="checkbox2"> -->
<!--                                                   <label for="checkbox2" class="mb-0"></label> -->
<!--                                               </div> -->
<!--                                           </td> -->
<!--                                           <td> -->
<!--                                               <div class="d-flex align-items-center"> -->
<!--                                                   <img src="assets/images/table/product/01.jpg" class="img-fluid rounded avatar-50 mr-3" alt="image"> -->
<!--                                                   <div> -->
<!--                                                       Organic Cream2蛋糕 -->
<!--                                                       <p class="mb-0"><small>This is test Product</small></p> -->
<!--                                                   </div> -->
<!--                                               </div> -->
<!--                                           </td> -->
<!--                                           <td>CREM09</td> -->
<!--                                           <td>Beauty</td> -->
<!--                                           <td>$25.00</td> -->
<!--                                           <td>Lakme</td> -->
<!--                                           <td>$10.00</td> -->
<!--                                           <td>10.0</td> -->
<!--                                           <td> -->
<!--                                               <div class="d-flex align-items-center list-action"> -->
<!--                                                   <a class="badge badge-info mr-2" data-toggle="tooltip" data-placement="top" title="" data-original-title="View" -->
<!--                                                       href="#"><i class="ri-eye-line mr-0"></i></a> -->
<!--                                                   <a class="badge bg-success mr-2" data-toggle="tooltip" data-placement="top" title="" data-original-title="Edit" -->
<!--                                                       href="#"><i class="ri-pencil-line mr-0"></i></a> -->
<!--                                                   <a class="badge bg-warning mr-2" data-toggle="tooltip" data-placement="top" title="" data-original-title="Delete" -->
<!--                                                       href="#"><i class="ri-delete-bin-line mr-0"></i></a> -->
<!--                                               </div> -->
<!--                                           </td> -->
<!--                                       </tr> -->
              <!-- 原始假資料結束 -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <!-- Page end  -->
    </div>
    <!-- Modal Edit -->
    <div class="modal fade" id="edit-note" tabindex="-1" role="dialog" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-body">
            <div class="popup text-left">
              <div class="media align-items-top justify-content-between">
                <h3 class="mb-3">Product</h3>
                <div class="btn-cancel p-0" data-dismiss="modal"><i class="las la-times"></i></div>
              </div>
              <div class="content edit-notes">
                <div class="card card-transparent card-block card-stretch event-note mb-0">
                  <div class="card-body px-0 bukmark">
                    <div class="d-flex align-items-center justify-content-between pb-2 mb-3 border-bottom">
                      <div class="quill-tool">
                      </div>
                    </div>
                    <div id="quill-toolbar1">
                      <p>Virtual Digital Marketing Course every week on Monday, Wednesday and Saturday.Virtual Digital
                        Marketing Course every week on Monday</p>
                    </div>
                  </div>
                  <div class="card-footer border-0">
                    <div class="d-flex flex-wrap align-items-ceter justify-content-end">
                      <div class="btn btn-primary mr-3" data-dismiss="modal">Cancel</div>
                      <div class="btn btn-outline-primary" data-dismiss="modal">Save</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Wrapper End-->


<!-- 燈箱的內容 -->

<!-- ----------------------------------------------- Edit 燈箱 ----------------------------------------------------------------- -->
<div class="modal fade" id="update-daily-special" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-body">
        <div class="popup text-left">
        <!-- 以下為更改的燈箱內容 -->
          <div class="container-fluid add-form-list">
	        <div class="row">
	            <div class="col-sm-12">
	                <div class="card">
	                    <div class="card-header d-flex justify-content-between">
	                        <div class="header-title">
	                            <h4 class="card-title">修改商品資訊</h4>
	                        </div>
	                    </div>
	                    <div class="card-body">
	                        <form id="updateProduct_form" action="javascript:void(0)" data-toggle="validator" enctype="multipart/form-data">
	                            <div class="row">
	                                <div class="col-md-6">
	                                    <div class="form-group">
	                                        <label id="update_product_name_label">商品名稱 *</label>
	                                        <input type="text" class="form-control" placeholder="自動產生" data-errors="Please Enter Code."  id="update_product_name" name="product_name" readonly>
	                                    </div> 
	                                </div>  
	                                <div class="col-md-6">
	                                    <div class="form-group">
	                                        <label>優惠編號 *</label>
	                                        <input type="text" class="form-control" placeholder="自動產生" data-errors="Please Enter Code."  id="update_discount_product_id" name="discount_product_id" readonly>
	                                        <div class="help-block with-errors"></div>
	                                    </div>
	                                </div>     
	                                <div class="col-md-6">
	                                    <div class="form-group">
	                                        <label id="update_discount_price_label">優惠價格 *</label>
	                                        <input type="text" class="form-control" placeholder="請輸入數字" data-errors="Please Enter Cost." id="update_discount_price" name="discount_price" required>
	                                        <div class="help-block with-errors"></div>
	                                    </div>
	                                </div>
	                                <div class="col-md-4">
	                                    <div class="form-group">
	                                        <label id="update_product_price_label">商品原價 *</label>
	                                        <input type="text" class="form-control" placeholder="自動帶入" data-errors="Please Enter Price." id="update_product_price" name="product_price" disabled>
	                                        <div class="help-block with-errors"></div>
	                                    </div>
	                                </div>
	                                <div class="col-md-2">
	                                    <div class="form-group">
	                                        <label id="update_product_id_label">商品編號 *</label>
	                                        <input type="text" class="form-control" placeholder="自動帶入" data-errors="Please Enter Price." id="update_product_id" name="product_id" readonly>
	                                        <div class="help-block with-errors"></div>
	                                    </div>
	                                </div>
	                                <div class="col-md-6">     
	                                	<div class="form-group">
	                                        <label id="update_discount_start_time_label">開始日期 *</label>
	                                        <input type="datetime-local" step="01" class="form-control" data-errors="Please Enter a Number." id="update_discount_start_time" name="discount_start_time" required>
	                                        <div class="help-block with-errors"></div>
	                                    </div>
	                                </div>
	                                <div class="col-md-6">                                    
	                                    <div class="form-group">
	                                        <label id="update_discount_deadline_label">結束日期 *</label>
	                                        <input type="datetime-local" step="01" class="form-control" id="update_discount_deadline" name="discount_deadline" required>
	                                        <div class="help-block with-errors"></div>
	                                    </div>
	                                </div>
<!-- 	                                <div class="col-md-4 "> -->
<!-- 		                              	<label>暫停優惠*</label> -->
<!-- 		                              <div class="form-group form-control discount_pause"> -->
<!-- 	                                	<div class="custom-control custom-checkbox -color-check custom-control-inline"> -->
<!-- 	                                  		<input type="radio" class="custom-control-input bg-primary" name="discount_status" value="0" checked> -->
<!-- 	                                  		<label class="custom-control-label">否</label> -->
<!-- 	                                	</div> -->
<!-- 		                                <br> -->
<!-- 		                                <div class="custom-control custom-checkbox custom-checkbox-color-check custom-control-inline"> -->
<!-- 		                                    <input type="radio" class="custom-control-input bg-primary" name="discount_status" value="1"> -->
<!-- 		                                    <label class="custom-control-label">是 (忽略優惠效期，強制下架優惠)</label> -->
<!-- 		                                </div> -->
<!-- 		                              </div> -->
<!-- 		                            </div> -->
	                            </div>                   
	                            <button type="submit" id="updateProduct" class="btn btn-primary mr-2">儲存修改</button>
								<button class="btn btn-danger" data-dismiss="modal">取消</button>
	                        </form>
	                    </div>
	                </div>
	            </div>
	        </div>
	        <!-- Page end  -->
	      </div>
	      <!-- 更改的燈箱內容end -->
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ----------------------------------------------- 右上角新增優惠商品 燈箱 ----------------------------------------------------------------- -->
<div class="modal fade" id="add-daily-special" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-body">
        <div class="popup text-left">
        <!-- 更改的燈箱內容start -->
          <div class="container-fluid add-form-list">
	        <div class="row">
	            <div class="col-sm-12">
	                <div class="card">
	                    <div class="card-header d-flex justify-content-between">
	                        <div class="header-title">
	                            <h4 class="card-title">新增每日優惠商品</h4>
	                        </div>
	                    </div>
	                    <div class="card-body">
	                        <form id="addDailySpecial_form" action="javascript:void(0)" data-toggle="validator" enctype="multipart/form-data">
	                            <div class="row">
	                                <div class="col-md-6">
	                                    <div class="form-group">
	                                        <label id="add_product_name_label">商品名稱 *</label>
	<!--                                         <select name="product_category" class="selectpicker form-control" data-style="py-0" id="product_category" required> -->
	                                        <select name="product_name" class="form-control selectpicker" data-style="py-0" id="add_product_name" required>
	                                            <option value>請選擇商品</option>
												<optgroup label="蛋糕" class="cakes">
												</optgroup>
												<optgroup label="巧克力" class="chocolates">
												</optgroup>
												<optgroup label="精緻小點" class="others">
												</optgroup>
												<optgroup label="飲品" class="drinks">
												</optgroup>
	                                        </select>
	                                    </div> 
	                                </div>  
	                                <div class="col-md-6">
	                                    <div class="form-group">
	                                        <label>優惠編號 *</label>
	                                        <input type="text" class="form-control" placeholder="自動產生" data-errors="Please Enter Code."  id="add_discount_product_id" name="add_discount_product_id" disabled>
	                                        <div class="help-block with-errors"></div>
	                                    </div>
	                                </div>     
	                                <div class="col-md-6">
	                                    <div class="form-group">
	                                        <label id="add_discount_price_label">優惠價格 *</label>
	                                        <input type="text" class="form-control" placeholder="請輸入數字" data-errors="Please Enter Cost." id="add_discount_price" name="discount_price" required>
	                                        <div class="help-block with-errors"></div>
	                                    </div>
	                                </div>
	                                <div class="col-md-4">
	                                    <div class="form-group">
	                                        <label id="add_product_price_label">商品原價 *</label>
	                                        <input type="text" class="form-control" placeholder="自動帶入" data-errors="Please Enter Price." id="add_product_price" name="product_price" disabled>
	                                        <div class="help-block with-errors"></div>
	                                    </div>
	                                </div>
	                                <div class="col-md-2">
	                                    <div class="form-group">
	                                        <label id="add_product_id_label">商品編號 *</label>
	                                        <input type="text" class="form-control" placeholder="自動帶入" data-errors="Please Enter Price." id="add_product_id" name="product_id" readonly>
	                                        <div class="help-block with-errors"></div>
	                                    </div>
	                                </div>
	                                <div class="col-md-6">     
	                                	<div class="form-group">
	                                        <label id="add_discount_start_time_label">開始日期 *</label>
	                                        <input type="datetime-local" step="01" class="form-control" data-errors="Please Enter a Number." id="add_discount_start_time" name="discount_start_time" required>
	                                        <div class="help-block with-errors"></div>
	                                    </div>
	                                </div>
	                                <div class="col-md-6">                                    
	                                    <div class="form-group">
	                                        <label id="add_discount_deadline_label">結束日期 *</label>
	                                        <input type="datetime-local" step="01" class="form-control" id="add_discount_deadline" name="discount_deadline" required>
	                                        <div class="help-block with-errors"></div>
	                                    </div>
	                                </div>
<!-- 	                                <div class="col-md-4 "> -->
<!-- 		                              	<label>暫停優惠*</label> -->
<!-- 		                              <div class="form-group form-control discount_pause"> -->
<!-- 	                                	<div class="custom-control custom-checkbox -color-check custom-control-inline"> -->
<!-- 	                                  		<input type="radio" class="custom-control-input bg-primary" name="discount_status" value="0" checked> -->
<!-- 	                                  		<label class="custom-control-label">否</label> -->
<!-- 	                                	</div> -->
<!-- 		                                <br> -->
<!-- 		                                <div class="custom-control custom-checkbox custom-checkbox-color-check custom-control-inline"> -->
<!-- 		                                    <input type="radio" class="custom-control-input bg-primary" name="discount_status" value="1"> -->
<!-- 		                                    <label class="custom-control-label">是 (忽略優惠效期，強制下架優惠)</label> -->
<!-- 		                                </div> -->
<!-- 		                              </div> -->
<!-- 		                            </div> -->
	                            </div>                            
	                            <button type="submit" id="addDailySpecial" class="btn btn-primary mr-2">送出新增</button>
	                            <button type="reset" class="btn btn-danger">重置</button>
	                        </form>
	                    </div>
	                </div>
	            </div>
	        </div>
	        <!-- Page end  -->
	      </div>
	    <!-- 更改的燈箱內容end -->
        </div>
      </div>
    </div>
  </div>
</div>












<!-- Backend Bundle JavaScript -->
<script src="assets/js/backend-bundle.min.js"></script>

<!-- Table Treeview JavaScript -->
<script src="assets/js/table-treeview.js"></script>

<!-- Chart Custom JavaScript -->
<script src="assets/js/customizer.js"></script>

<!-- Chart Custom JavaScript -->
<script async src="assets/js/chart-custom.js"></script>

<!-- app JavaScript -->
<script src="assets/js/app.js"></script>

<!-- moment -->
<script src="assets/js/moment.js"></script>


<script>
    $(document).ready(function () {
        $('.header').load('header.html')
        // $('.footer').load('footer.html')
    })
</script>


<!-- 商品展示 -->
<script>

getAllDailySpecial();


/****************進頁面先初始化表格*********************/
let table=$(".data-table").DataTable();
	table.destroy();
	table = $(".data-table").DataTable({
              "lengthMenu": [5, 10, 20],     //顯示幾項結果
              "language": {
                  "processing": "處理中...",
                  "loadingRecords": "載入中...",
                  "lengthMenu": "顯示 _MENU_ 項結果",
                  "zeroRecords": "沒有符合的結果",
                  "info": "顯示第 _START_ 至 _END_ 項結果，共 _TOTAL_ 項",
                  "infoEmpty": "顯示第 0 至 0 項結果，共 0 項",
                  "infoFiltered": "(從 _MAX_ 項結果中過濾)",
                  "infoPostFix": "",
                  "search": "搜尋:",
                  "paginate": {
                      "first": "第一頁",
                      "previous": "上一頁",
                      "next": "下一頁",
                      "last": "最後一頁"
                  },
                  "aria": {
                      "sortAscending": ": 升冪排列",
                      "sortDescending": ": 降冪排列"
                  }
              },
              "createdRow": function (row, data, dataIndex, text, column) {
	    	if(data[10] != "生效中" & data[10] !="尚未開始"){
           		$(row).css("background-color", "#EFF0F2");
	    	}else if(data[10] =="尚未開始"){
	    		$(row).css("background-color", "#f1f8f1");
	    	}
		},
              "columnDefs": [
                  {
                      "targets": [0],    //欄位從0開始算
                      "visible": true,   //欄位是否顯示 預設是true
                      "orderable": true,  //是否可以排序
                  },
                  {
                      "targets": [1, 2],    //欄位從0開始算
                      "visible": true,   //欄位是否顯示 預設是true
                      "orderable": true,  //是否可以排序
                  },
                  {
                  	  "targets": [9],    //欄位從0開始算
                      "visible": true,   //欄位是否顯示 預設是true
                      "orderable": true,  //是否可以排序
	               	  "createdCell": function (td, cellData, rowData, row, col) {
				   	  		if(cellData == "未上架"){
				   				$(td).css("color","red");
				   			}
						}
                  }

              ]
     });


let url = location.href.split("/TEA103G2")[0];
function getAllDailySpecial(){
<!--因為有商品成分跟介紹的部分 所以應該要做預覽-->		
		var action = `<div class="d-flex align-items-center list-action">
            			<a class="badge bg-success mr-2" data-toggle="modal" data-target="#update-daily-special" data-placement="top" title="" data-original-title="Edit"
                			href="javascript:void(0)"><i class="ri-pencil-line mr-0"></i></a>
            			<a class="badge bg-warning mr-2" data-toggle="tooltip" data-placement="top" title="" data-original-title="Delete"
                			href="javascript:void(0)"><i class="ri-delete-bin-line mr-0"></i></a>
        			  </div>`
  			  
    $.get("/dessert_shop/dailySpecial/backend_getAllDailySpecialProduct", {}, function (data) {
		if(data.flag){
			
			let table = $(".data-table").DataTable()
			table.clear().draw();
			for (var i = 0; i < data.data.length; i++) {
	            // 撈第一張照片
	            let product_img1 = url + data.data[i].image_url[0];
	            table.row.add([
	            	data.data[i].discount_product_id,
	            	'<img class="table-img avatar-50" src="'+product_img1+'">',
	            	data.data[i].product_name,
	            	data.data[i].product_id,
	            	data.data[i].product_subtype,
	           		data.data[i].product_price,
	           		data.data[i].discount_price,
	            	getTime(data.data[i].discount_start_time),
	            	getTime(data.data[i].discount_deadline),
	            	data.data[i].product_status == 0 ? "未上架" : "上架中",
	            	getStatus(data.data[i].product_status, data.data[i].discount_status),
	            	
	            	action
	            ]).draw(true);
			}
		}else{
		}
		
		
    });//$.get
    
}//function getAllDailySpecialProduct();    

function getTime(time) {
    return moment(time).format('YYYY-MM-DD HH:mm:ss')
}
function getStatus(pStatus, dStatus){
	if(pStatus == 0 & dStatus == 0){
		return "尚未開始";
	}else if(pStatus == 0 & dStatus == 1){
		return "未啟動, 產品下架";	
	}else if(pStatus == 0 & dStatus == 2){
		return "已過期";
	}else if(pStatus == 1 & dStatus == 0){
		return "尚未開始";
	}else if(pStatus == 1 & dStatus == 1){
		return "生效中";
	}else if(pStatus == 1 & dStatus == 2){
		return "已過期";
	}
}


// -----------------------  新增燈箱  ----------------------- //
// ****開啟**** //
// $(".add-daily-special-button").on("click",function(){
// 	console.log("click按鈕");
// 	$("#addDailySpecial_from").trigger("reset"); // 無效
// })	

// ****下拉選單出現所有商品**** //
$.get("/dessert_shop/product/backend_getAllProduct", {}, function(data){
     if(data.flag){
    	 for(var i = 0 ; i < data.data.length ; i++){
    		 let product_type = data.data[i].product_type;
    		 switch(product_type){
    		 	case "蛋糕":
    		 		$(".cakes").append(`<option value="` + data.data[i].product_name + `">`+ data.data[i].product_name+`</option>`)
    		 		break;
    		 	case "巧克力":
    		 		$(".chocolates").append(`<option value="` + data.data[i].product_name + `">`+ data.data[i].product_name+`</option>`)
    		 		break;
    		 	case "精緻小點":
    		 		$(".others").append(`<option value="` + data.data[i].product_name + `">`+ data.data[i].product_name+`</option>`)
    		 		break;
    		 	case "飲品":
    		 		$(".drinks").append(`<option value="` + + data.data[i].product_name + `">`+ data.data[i].product_name+`</option>`)
    		 		break;
    		 	default:
    		 	//	
    		 }
    	 }
    	 $(".update_product_category").selectpicker('refresh');
     }
});

// ****選單選項帶出原有價格跟id**** //
$("#add_product_name").on("change", function(){
	console.log("選項");
	let product_name_data = "product_name=" + $(this).val().trim();
	console.log("product_name_data:"+product_name_data);
	$.post("/dessert_shop/product/product/backend_getOneProductByName?", product_name_data, function(data){
		
 	console.log("data.flag:"+data.flat);
		if(data.flag){
			let product_price = data.data.product_price;
			let product_id = data.data.product_id;
			console.log("product_price:"+product_price);
			$("#add_product_price").val(product_price);
			$("#add_product_id").val(product_id);
		}
	});
	
});
	
// ****送出新增**** //	
	$("#addDailySpecial").on("click",function(e){
// 	$("#addProduct_form").submit(function(e){
	    console.log("新增優惠燈箱submit the form");
		//照片新增到後台
		let form = $("#addDailySpecial_form")[0];
		console.log("form test1");
		let data = new FormData(form);
		console.log("form test2");
			
		$.ajax({
			type: "POST",
			enctype: 'multipart/form-data',
			url: '/dessert_shop/dailySpecial/backend_addDailySpecial',
			data: data,
			processData: false,
			contentType: false,
			cache: false,
			success: function (data) {
				console.log("ajax:"+data);
				if (data.flag) {
					   
					Swal.fire({
						title: data.msg,
						text: "提交成功",
						icon: "success"
					}).then(function(){
						location.href="daily-special.html";
					});
						
				} else {
					// 新增失敗 彈出視窗
					Swal.fire({
						title: data.msg,
						text: "提交失敗",
						icon: "error"
					})
				}
			}
		});
		
		return false;	
		
    });//addProduct_form表單submit
	
    
	
	
	
// -----------------------  更新燈箱  ----------------------- //
//**** 開啟 ****//	
$("tbody").on("click", "a.bg-success", function(){
	console.log("edit");
	let table = $(".data-table").DataTable();
	let data = table.row($(this).closest('tr')).data();
	
	console.log("discount_product_id:"+data[0]);
	console.log("product_name:"+data[2]);
	console.log("product_id:"+data[3]);
	
   	$("#update_discount_product_id").val(data[0]);
   	let product_name = data[2];
   	$("#update_product_name").val(product_name);
   	$("#update_product_id").val(data[3]);
    $("#update_product_price").val(data[5]);
    $("#update_discount_price").val(data[6]);
    
	$("#update_discount_start_time").val(moment(data[7]).format('YYYY-MM-DDTHH:mm:ss.SSS'));
    $("#update_discount_deadline").val(moment(data[8]).format('YYYY-MM-DDTHH:mm:ss.SSS'));
	
	
});//更新燈箱


	// ****更新 送出修改**** //
	$("#updateProduct").on("click", function(e){
		e.preventDefault();
		console.log("更新送出");
		
		let form = $("#updateProduct_form")[0];
		let data = new FormData(form);
		$.ajax({
			type: "POST",
            enctype: 'multipart/form-data',
            url: '/dessert_shop/dailySpecial/backend_updateDailySpecial',
            data: data,
            processData: false,
            contentType: false,
            cache: false,
            success: function (data) {
                if (data.flag) {
                    Swal.fire({
                        title: data.msg,
                        text: "修改成功",
                        icon: "success"
                    });
                    getAllDailySpecial();
                    $("#update-daily-special").modal('hide');
                } else {
                    Swal.fire({
                        title: data.msg,
                        text: "更新失敗",
                        icon: "error"
                    })
                }
            }
		
		
		});//$.ajax
		
		return false;
	});
	
	// ----------------- 刪除優惠 ----------------- //
	$("tbody").on("click", "a.bg-warning", function(e){
		e.preventDefault();
		console.log("刪除優惠活動");
		const swalWithBootstrapButtons = Swal.mixin({
			  customClass: {
			    confirmButton: 'btn btn-success',
			    cancelButton: 'btn btn-danger'
			  },
			  buttonsStyling: false
		})
		
		swalWithBootstrapButtons.fire({
			  title: '確定要刪除嗎?',
			  icon: 'warning',
			  showCancelButton: true,
			  confirmButtonText: '是, 確認刪除!',
			  cancelButtonText: '取消',
			  reverseButtons: true
			}).then((result) => {
			  if (result.isConfirmed) {
				// DB更改
				let table = $(".data-table").DataTable();
				let data = table.row($(this).closest('tr')).data();
				
				let discount_product_id = data[0];
				$.post("/dessert_shop/dailySpecial/backend_deleteDailySpecial", { discount_product_id }, function(data){
					if(data.flag == true){
						console.log("已刪除優惠活動");
		                getAllDailySpecial();
					}else{
						console.log("刪除優惠失敗");
						
					}
				});//$.post
				//
			    swalWithBootstrapButtons.fire(
			      '已刪除!',
			      '',
			      'success'
			    )
			  } else if (
			    /* Read more about handling dismissals below */
			    result.dismiss === Swal.DismissReason.cancel
			  ) {
			    swalWithBootstrapButtons.fire(
			      '已取消',
			      '',
			      'error'
			    )
			  }
			})
			 
			 
		
	});
	
    
    
</script>
    
    
  </body>
</html>
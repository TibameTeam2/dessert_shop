<!DOCTYPE html>
<html lang="zh-Hant">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>嗜甜-註冊</title>
  <meta name="robots" content="noindex, follow"/>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <!-- Favicon -->
  <link rel="shortcut icon" type="image/x-icon" href="assets/images/favicon.png">

  <!-- CSS
============================================ -->

  <!-- Icon Font CSS -->
  <link rel="stylesheet" href="assets/css/plugins/ionicons.min.css">
  <link rel="stylesheet" href="assets/css/plugins/line-awesome.min.css">
  <link rel="stylesheet" href="assets/css/plugins/fontawesome.min.css">

  <!-- Plugins CSS -->
  <link rel="stylesheet" href="assets/css/plugins/animate.min.css">
  <link rel="stylesheet" href="assets/css/plugins/swiper-bundle.min.css">
  <link rel="stylesheet" href="assets/css/plugins/nice-select.css">
  <link rel="stylesheet" href="assets/css/plugins/select2.min.css">
  <link rel="stylesheet" href="assets/css/plugins/jquery-ui.min.css">
  <link rel="stylesheet" href="assets/css/plugins/magnific-popup.css">

  <!-- Main Style CSS -->
  <link rel="stylesheet" href="assets/css/style.css">
  <link rel="stylesheet" href="assets/css/custom.css">

  <!--====== Use the minified version files listed below for better performance and remove the files listed above ======-->
  <!-- <link rel="stylesheet" href="assets/css/vendor/plugins.min.css">
  <link rel="stylesheet" href="assets/css/style.min.css"> -->

  <style>
      .single-form {
          margin-top: 10px;
      }

      a {
          text-decoration: none;
          color: blue;
      }

      .single-form .form-control {
          height: 30px;
          border-radius: 5px;
          padding: 10px 15px;
          border-color: #83bc2e;
          font-size: 14px;
      }

      .single-form .form-control:focus {
          -webkit-box-shadow: none;
          box-shadow: none;
          border-color: #83bc2e;
      }

      .single-form .form-control + .form-control {
          margin-top: 20px;
      }

      .single-form .form-control {
          margin-bottom: 10px;
      }

      .form-label {
          margin-bottom: 0px !important;
      }
  </style>
  <!--    <link rel="stylesheet" type="text/css" href="assets/css/loading.css" />-->
  <!-- Modernizer & jQuery JS -->
  <script src="assets/js/vendor/modernizr-3.11.2.min.js"></script>
  <script src="assets/js/vendor/jquery-3.5.1.min.js"></script>
  <script src="assets/js/vendor/jquery.waitforimages.min.js"></script>
  <script src="assets/js/plugins/sweetalert2.all.min.js"></script>

</head>


<body>
<!-- Loading Progress
============================================= -->
<div id="loading-progress">
  <a class="logo" href="#">
    <img src="assets/images/sweetness_logo.png" data-logo-alt="images/files/logo-header.png" alt="">
<!--    <img src="assets/images/logo.jpg" data-logo-alt="images/files/logo-header.png" alt="">-->
    <!--        <h3><span class="colored">Astron</span></h3>-->
    <!--        <span>HTML Template</span>-->
  </a><!-- .logo end -->
  <div class="lp-content">
    <div class="lp-counter">
      Loading
      <div id="lp-counter">0%</div>
    </div><!-- .lp-counter end -->
    <div class="lp-bar">
      <div id="lp-bar"></div>
    </div><!-- .lp-bar end -->
  </div><!-- .lp-content end -->
</div>
<!-- #loading-progress end -->


<div class="main-wrapper">
  <!--Header-->
  <div class="header"></div>
  <!--Page Banner Start-->
  <div class="section page-banner-wrapper bg-cover" style="background-image: url(assets/images/page-banner.jpg);">
    <div class="container">
      <div class="page-banner">
        <ul class="breadcrumb justify-content-center">
          <li class="breadcrumb-item"><a href="index.html">Home</a></li>
          <li class="breadcrumb-item active">Register</li>
        </ul>
      </div>
    </div>
  </div>
  <!--Page Banner Start-->

  <!-- Register Section Start -->
  <div class="section section-padding-02 mt-n1">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-lg-6">
          <!-- Login & Register Start -->
          <div class="login-register-wrapper">
            <h4 class="title">建立帳號</h4>
            <p>已有帳號? <a href="login.html">立刻登入!</a></p>
            <form id="register_form" action="#">
              <div class="single-form">
                <label class="form-label" id="member_account_label">註冊帳號</label>
                <input type="text" class="form-control" id="member_account" name="member_account">
              </div>
              <div class="single-form">
                <label class="form-label">密碼</label>
                <label class="form-label" id="member_password_label"></label>
                <input type="password" id="member_password" class="form-control" name="member_password">
              </div>
              <div class="single-form">
                <label class="form-label">確認密碼</label>
                <label class="form-label" id="member_repeat_password_label"></label>
                <input type="password" id="member_repeat_password" class="form-control">
              </div>
              <div class="single-form">
                <label class="form-label">信箱</label>
                <label class="form-label" id="member_email_label"></label>
                <input type="text" id="member_email" class="form-control" name="member_email">
              </div>
              <div class="single-form">
                <label class="form-label">姓名</label>
                <label class="form-label" id="member_name_label"></label>
                <input type="text" id="member_name" class="form-control" name="member_name">
              </div>
              <div class="single-form">
                <label class="form-label">手機</label>
                <label class="form-label" id="member_phone_label"></label>
                <input type="text" id="member_phone" class="form-control" name="member_phone">
              </div>
              <!--                            <div class="single-form">-->
              <!--                                <label class="form-label">性別</label>-->
              <!--                                <input type="text" class="form-control" name="member_gender">-->
              <!--                            </div>-->
              <div class="single-form">
                <label class="form-label">性別</label><br>
                <input type="radio" name="member_gender" id="radio1" value="1" checked>
                <label for="radio1"><span></span>男</label>
                <input type="radio" name="member_gender" id="radio2" value="0">
                <label for="radio2"><span></span>女</label>
              </div>

              <div class="single-form">
                <label class="form-label">生日</label>
                <label class="form-label" id="member_birthday_label"></label>
                <input type="date" id="member_birthday" class="form-control" name="member_birthday">
              </div>
              <div class="single-form">
                <label class="form-label">驗證碼</label>
                <label class="form-label" id="checkCode_label"></label>
                <div class="container">
                  <div class="row">
                    <div class="col-8 justify-content-start margin-left">
                      <input type="text" class="form-control" id="checkCode" name="code">
                    </div>
                    <div class="col-4">
                      <img src="/dessert_shop/member/checkCode" height="50px" id="checkCodeImg"
                           alt="">
                    </div>
                  </div>
                </div>


              </div>
              <div class="form-check">
                <input type="checkbox" class="form-check-input" id="receive">
                <label class="form-check-label" for="receive">我已詳閱隱私權條款，充分了解並同意。</label>
              </div>
              <!--                                <div class="form-check">-->
              <!--                                    <input type="checkbox" class="form-check-input" id="newsletter">-->
              <!--                                    <label class="form-check-label" for="newsletter">Sign Up For Our Newsletter <br>-->
              <!--											Subscribe To Our Newsletters Now And Stay Up-To-Date With New Collections, The Latest Lookbooks And Exclusive Offers.</label>-->
              <!--                                </div>-->
              <div class="single-form">
                <button class="btn btn-primary btn-hover-dark">註冊</button>
              </div>
              <input type="hidden" name="register_method" value="1">
              <input type="hidden" name="member_status" value="0">
            </form>
          </div>
          <!-- Login & Register End -->
        </div>
      </div>
    </div>
  </div>
  <!-- Register Section End -->

  <!--Footer-->
  <div class="footer"></div>
</div>


<!-- JS
============================================ -->


<!-- Bootstrap JS -->
<script src="assets/js/plugins/popper.min.js"></script>
<script src="assets/js/plugins/bootstrap.min.js"></script>

<!-- Plugins JS -->
<script src="assets/js/plugins/swiper-bundle.min.js"></script>
<script src="assets/js/plugins/jquery.nice-select.min.js"></script>
<script src="assets/js/plugins/select2.min.js"></script>
<script src="assets/js/plugins/jquery-ui.min.js"></script>
<script src="assets/js/plugins/jquery.magnific-popup.min.js"></script>
<script src="assets/js/plugins/jquery.zoom.min.js"></script>
<script src="assets/js/plugins/ajax-contact.js"></script>
<!--====== Use the minified version files listed below for better performance and remove the files listed above ======-->
<!-- <script src="assets/js/plugins.min.js"></script> -->


<!-- Main JS -->
<script src="assets/js/main.js"></script>


<script>

    $(document).ready(function () {
        $('.header').load('header.html')
        $('.footer').load('footer.html')
    })

    $("body").waitForImages({
        finished: function () {
            setTimeout(function () {
                $(".lp-content, #loading-progress .logo").css({opacity: 0})
                $("#loading-progress").addClass("hide-it"),
                    setTimeout(function () {
                        $(".banner-parallax > .bg-element, .banner-parallax > .overlay-pattern").addClass("appeared")
                    }, 1000)
            }, 0)
        }, each: function (a, t, e) {
            var n = Math.floor((a + 1) / t * 100);
            $("#lp-counter").animate({$this: n}, {
                duration: 150, easing: "", queue: !1, step: function (a) {
                    var t = Math.round(a);
                    $("#lp-counter").text(t + "%")
                }
            }), $("#lp-bar").animate({width: n + "%"}, 0)
        }, waitForAll: !0
    });


    $(function () {

        //更換驗證碼
        $("#checkCodeImg").on("click", function () {
            $("#checkCodeImg").attr("src", "/dessert_shop/member/checkCode?" + new Date().getTime())
        });


        $("#member_account").blur(checkAccount);
        $("#member_password").blur(checkPassword);
        $("#member_email").blur(checkEmail);
        $("#member_repeat_password").blur(checkRepeatPassword);
        $("#member_name").blur(checkName);
        $("#member_phone").blur(checkPhone);
        $("#member_birthday").blur(checkBirthday);
        $("#checkCode").blur(checkCode);
        //表單送出時
        $("#register_form").submit(function () {
            //表單提交時檢查所有屬性合法
            if (checkAccount() & checkPassword() & checkEmail() & checkRepeatPassword() &
                checkName() & checkPhone() & checkBirthday() & checkCode()) {
                //發送ajax請求，送出表單資料
                console.log($("#register_form").serialize());
                $.post("/dessert_shop/member/register", $(this).serialize(), function (data) {
                    //處理伺服器回應的資料  data  {flag:true,errorMsg:"註冊成功!!!"}
                    if (data.flag) {
                        // 註冊成功後跳轉頁面
                        // location.href="register_ok.html";
                        Swal.fire({
                            title: data.msg,
                            text: "請至信箱收信以啟用帳號",
                            icon: "success"
                        }).then(function () {
                            location.href = data.redirect;
                        });
                    } else {
                        // 註冊失敗 彈出視窗
                        Swal.fire(
                            data.msg,
                            '',
                            'error'
                        )
                    }
                });

            }else{
                Swal.fire(
                    "請檢查表單",
                    '',
                    'error'
                )
            }
            //2.不跳轉頁面，等資料回來會做跳轉
            return false;
            //如果為true，表單提交，如果為false，不提交
            //在這裡不管怎樣都是false，因為跳轉的功能在ajax中實現了
        });

        // 失去焦點 調用檢查方法
        $("#member_account").blur(checkAccount);
        $("#member_password").blur(checkPassword);
        $("#member_email").blur(checkEmail);
        $("#member_repeat_password").blur(checkRepeatPassword);
        $("#member_name").blur(checkName);
        $("#member_phone").blur(checkPhone);
        $("#member_birthday").blur(checkBirthday);
        $("#checkCode").blur(checkCode);


        /**************檢查帳號****************/
        function checkAccount() {
            let account = $("#member_account").val().trim()
            let reg_account = /^\w{3,20}$/;
            let flag = reg_account.test(account);
            if (flag) {
                //用户名合法
                $("#member_account").css("border", "");
            } else {
                //用户名非法,加一个红色边框
                $("#member_account").css("border", "2px solid red");
                $("#member_account").css("border-color", "red");


                $("#member_account_label").html("註冊帳號");
                return flag;
            }


            let account_data = "account=" + $("#member_account").val().trim();
            $.post("/dessert_shop/member/checkAccount", account_data, function (data) {
                if (data.flag) {
                    // alert(data.msg);
                    $("#member_account").css("border", "");
                    $("#member_account_label").html("註冊帳號&nbsp&nbsp&nbsp&nbsp" + data.msg);
                } else {
                    // alert(data.msg);
                    $("#member_account").css("border", "2px solid red");
                    $("#member_account_label").html("註冊帳號&nbsp&nbsp&nbsp&nbsp" + data.msg);
                }
            });
            return flag;
        }

        /**************檢查密碼****************/
        function checkPassword() {
            let password = $("#member_password").val().trim()
            let reg_account = /^\w{3,20}$/;
            let flag = reg_account.test(password);
            if (flag) {
                //密碼合法
                $("#member_password_label").text("");
                $("#member_password").css("border", "2px solid green");
            } else {
                //用户名非法,加一个红色边框
                $("#member_password_label").text("長度必須介於3~20字");
                $("#member_password").css("border", "2px solid red");
            }
            return flag;
        }

        /**************檢查重複輸入的密碼****************/
        function checkRepeatPassword() {
            let password = $("#member_password").val().trim()
            let repeat_password = $("#member_repeat_password").val().trim()
            if (repeat_password === "") {
                $("#member_repeat_password_label").text("請先輸入密碼");
                $("#member_repeat_password").css("border", "2px solid red");
                return false;
            }
            if (password === repeat_password) {
                //密碼合法
                $("#member_repeat_password_label").text("");
                $("#member_repeat_password").css("border", "2px solid green");
                return true;
            } else {
                //用户名非法,加一个红色边框
                $("#member_repeat_password_label").text("密碼不一致");
                $("#member_repeat_password").css("border", "2px solid red");
                return false;
            }
        }


        /**************檢查信箱****************/
        function checkEmail() {
            let email = $("#member_email").val().trim()
            let reg =  /^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z]+$/;
            let flag = reg.test(email);
            if (flag) {
                //密碼合法
                $("#member_email_label").text("");
                $("#member_email").css("border", "2px solid green");
            } else {
                //用户名非法,加一个红色边框
                $("#member_email_label").text("格式不符");
                $("#member_email").css("border", "2px solid red");
            }
            return flag;
        }

        /**************檢查姓名****************/
        function checkName() {
            let name = $("#member_name").val().trim()
            if (name !== "") {
                //密碼合法
                $("#member_name_label").text("");
                $("#member_name").css("border", "2px solid green");
                return true;
            } else {
                //用户名非法,加一个红色边框
                $("#member_name_label").text("不可為空");
                $("#member_name").css("border", "2px solid red");
                return false;
            }

        }

        /**************檢查手機****************/
        function checkPhone() {
            let phone = $("#member_phone").val().trim()
            let reg = /^\d{10}$/;
            let flag = reg.test(phone);
            if (flag) {
                //密碼合法
                $("#member_phone_label").text("");
                $("#member_phone").css("border", "2px solid green");
            } else {
                //用户名非法,加一个红色边框
                $("#member_phone_label").text("請輸入正確的手機號碼");
                $("#member_phone").css("border", "2px solid red");
            }
            return flag;
        }

        /**************檢查生日****************/
        function checkBirthday() {
            let birthday = $("#member_birthday").val().trim()
            // console.log(birthday)
            if (birthday !== "") {
                //密碼合法
                $("#member_birthday_label").text("");
                $("#member_birthday").css("border", "2px solid green");
                return true;
            } else {
                //用户名非法,加一个红色边框
                $("#member_birthday_label").text("請選擇生日");
                $("#member_birthday").css("border", "2px solid red");
                return false;
            }
        }

        /**************檢查驗證碼****************/
        function checkCode() {
            let code = $("#checkCode").val().trim()
            if (code !== "") {
                //密碼合法
                $("#checkCode_label").text("");
                $("#checkCode").css("border", "");
                return true;
            } else {
                //用户名非法,加一个红色边框
                $("#checkCode_label").text("不可為空");
                $("#checkCode").css("border", "2px solid red");
                return false;
            }

        }

    });


</script>
</body>

</html>

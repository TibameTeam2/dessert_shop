<!DOCTYPE html>
<html lang="zh-Hant">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <META HTTP-EQUIV="pragma" CONTENT="no-cache">
  <META HTTP-EQUIV="Cache-Control" CONTENT="no-cache, must-revalidate">
  <META HTTP-EQUIV="expires" CONTENT="0">
  <title>嗜甜-商品比較</title>
  <meta name="robots" content="noindex, follow"/>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <!-- Favicon -->
  <link rel="shortcut icon" type="image/x-icon" href="assets/images/favicon.png">

  <!-- CSS
============================================ -->

  <!-- Icon Font CSS -->
  <link rel="stylesheet" href="assets/css/plugins/ionicons.min.css">
  <link rel="stylesheet" href="assets/css/plugins/line-awesome.min.css">
  <link rel="stylesheet" href="assets/css/plugins/fontawesome.min.css">

  <!-- Plugins CSS -->
  <link rel="stylesheet" href="assets/css/plugins/animate.min.css">
  <link rel="stylesheet" href="assets/css/plugins/swiper-bundle.min.css">
  <link rel="stylesheet" href="assets/css/plugins/nice-select.css">
  <link rel="stylesheet" href="assets/css/plugins/select2.min.css">
  <link rel="stylesheet" href="assets/css/plugins/jquery-ui.min.css">
  <link rel="stylesheet" href="assets/css/plugins/magnific-popup.css">

  <!-- Main Style CSS -->
  <link rel="stylesheet" href="assets/css/style.css">
  <link rel="stylesheet" href="assets/css/custom.css">

  <!--====== Use the minified version files listed below for better performance and remove the files listed above ======-->
  <!-- <link rel="stylesheet" href="assets/css/vendor/plugins.min.css">
  <link rel="stylesheet" href="assets/css/style.min.css"> -->
  <!-- Modernizer & jQuery JS -->
  <script src="assets/js/vendor/modernizr-3.11.2.min.js"></script>
  <script src="assets/js/vendor/jquery-3.5.1.min.js"></script>
  <script src="assets/js/vendor/jquery.waitforimages.min.js"></script>
  <script src="assets/js/plugins/sweetalert2.all.min.js"></script>
  <style>
    td{
        width : 26%;
    }
    th{
        width : 20%;
    }
  </style>
</head>

<body>
<!-- Loading Progress
============================================= -->
<div id="loading-progress">
  <a class="logo" href="#">
    <img src="assets/images/sweetness_logo.png" data-logo-alt="images/files/logo-header.png" alt="">
<!--    <img src="assets/images/logo.jpg" data-logo-alt="images/files/logo-header.png" alt="">-->
    <!--        <h3><span class="colored">Astron</span></h3>-->
    <!--        <span>HTML Template</span>-->
  </a><!-- .logo end -->
  <div class="lp-content">
    <div class="lp-counter">
      Loading
      <div id="lp-counter">0%</div>
    </div><!-- .lp-counter end -->
    <div class="lp-bar">
      <div id="lp-bar"></div>
    </div><!-- .lp-bar end -->
  </div><!-- .lp-content end -->
</div>
<!-- #loading-progress end -->


<div class="main-wrapper">

  <!--Header-->
  <div class="header"></div>
  <!--Page Banner Start-->
  <div class="section page-banner-wrapper bg-cover" style="background-image: url(assets/images/page-banner.jpg);">
    <div class="container">
      <div class="page-banner">
        <ul class="breadcrumb justify-content-center">
          <li class="breadcrumb-item"><a href="index.html">Home</a></li>
          <li class="breadcrumb-item active">Compare</li>
        </ul>
      </div>
    </div>
  </div>
  <!--Page Banner Start-->

  <!-- Compare Section Start -->
  <div class="section section-padding-02 mt-n4 mb-n3">
    <div class="container">
      <!-- compare Start -->
      <div class="compare-wrapper table-responsive">
        <table class="table table-striped ">
          <tbody>
          <tr id="product">
            <th>
              <a href="javascript:void(0)" class="removeAll">移除所有商品</a>
            </th>
          </tr>
          <tr id="product_type">
            <th>主類別</th>
          </tr>
          <tr id="product_intro">
            <th>簡介</th>
          </tr>
          <tr id="product_calorie">
            <th>熱量</th>
          </tr>
          <tr id="product_ingredient">
            <th>成分</th>
          </tr>
          <tr id="degree_of_sweetness">
            <th>甜度</th>
          </tr>
          <tr id="avg_star">
            <th>平均星等</th>
          </tr>
          <tr id="expiry_after_buying">
            <th>可放天數</th>
          </tr>
          <tr id="product_price">
            <th>價格</th>
          </tr>
          </tbody>
        </table>
      </div>
      <!-- compare End -->
    </div>
  </div>
  <!-- Compare Section End -->

  <!--Footer-->
  <div class="footer"></div>
</div>


<!-- JS
============================================ -->


<!-- Bootstrap JS -->
<script src="assets/js/plugins/popper.min.js"></script>
<script src="assets/js/plugins/bootstrap.min.js"></script>

<!-- Plugins JS -->
<script src="assets/js/plugins/swiper-bundle.min.js"></script>
<script src="assets/js/plugins/jquery.nice-select.min.js"></script>
<script src="assets/js/plugins/select2.min.js"></script>
<script src="assets/js/plugins/jquery-ui.min.js"></script>
<script src="assets/js/plugins/jquery.magnific-popup.min.js"></script>
<script src="assets/js/plugins/jquery.zoom.min.js"></script>
<script src="assets/js/plugins/ajax-contact.js"></script>

<!--====== Use the minified version files listed below for better performance and remove the files listed above ======-->
<!-- <script src="assets/js/plugins.min.js"></script> -->


<!-- Main JS -->
<script src="assets/js/main.js"></script>
<script src="assets/js/moment.js"></script>

<script>
    $(document).ready(function () {
        $('.header').load('header.html')
        $('.footer').load('footer.html')

    })

    $("body").waitForImages({
        finished: function () {
            setTimeout(function () {
                $(".lp-content, #loading-progress .logo").css({
                    opacity: 0
                })
                $("#loading-progress").addClass("hide-it"),
                    setTimeout(function () {
                        $(".banner-parallax > .bg-element, .banner-parallax > .overlay-pattern").addClass("appeared")
                    }, 1000)
            }, 0)
        },
        each: function (a, t, e) {
            var n = Math.floor((a + 1) / t * 100);
            $("#lp-counter").animate({
                $this: n
            }, {
                duration: 150,
                easing: "",
                queue: !1,
                step: function (a) {
                    var t = Math.round(a);
                    $("#lp-counter").text(t + "%")
                }
            }), $("#lp-bar").animate({
                width: n + "%"
            }, 0)
        },
        waitForAll: !0
    });
</script>
<script>
    $(function () {

        // let names = [1,2,3];
        // localStorage.setItem("compareList", JSON.stringify(names));

        let compareList = JSON.parse(localStorage.getItem("compareList"));
        console.log(compareList);

        for (let i = 0; i < compareList.length; i++) {
            $.get("/dessert_shop/product/getOneProduct?id=" + compareList[i], {}, function (data) {

                let product_id = data.data.product_id;
                let product_name = data.data.product_name;
                let product_type = data.data.product_type;
                let product_subtype = data.data.product_subtype;
                let product_intro = data.data.product_intro;
                let product_ingredient = data.data.product_ingredient;
                let product_price = data.data.product_price;
                let product_available_qty = data.data.product_available_qty;
                let expiry_after_buying = data.data.expiry_after_buying;
                let product_calorie = data.data.product_calorie;
                let degree_of_sweetness = data.data.degree_of_sweetness;

                let avg_star = (data.data.total_star / data.data.total_review);
                let fixed_star = avg_star.toFixed(1);

                let total_review = data.data.total_review;
                let total_purchase = data.data.total_purchase;


                let image_list = data.data.image_url.valueOf();

                // 照片迴圈
                let url = location.href.split("/TEA103G2")[0];

                let product_img1 = url + image_list[0];
                let product_img2 = url + image_list[1];


                $("#product_type").append(`<td data-product_id="${product_id}">${product_type}</td>`);
                $("#product_intro").append(`<td data-product_id="${product_id}">${product_intro}</td>`);
                $("#product_calorie").append(`<td data-product_id="${product_id}">${product_calorie}大卡</td>`);
                $("#product_ingredient").append(`<td data-product_id="${product_id}">${product_ingredient}</td>`);
                $("#degree_of_sweetness").append(`<td data-product_id="${product_id}">${degree_of_sweetness}°Bx</td>`);
                $("#avg_star").append(`<td data-product_id="${product_id}">${fixed_star}顆星</td>`);
                $("#expiry_after_buying").append(`<td data-product_id="${product_id}">${expiry_after_buying}天</td>`);
                $("#product_price").append(`<td data-product_id="${product_id}">${product_price}元</td>`);


                let product = `<td data-product_id="${product_id}">
              <div class="compare-product " >
                <div class="pack-product-container">
                  <div class="thumb-mask">
                    <a href="shop-single.html">
                      <img src="${product_img1}" alt="">
                    </a>
                  </div>
                  <div class="desc-box">
                    <a class="product-name" href="shop-single.html">${product_name}</a>
<!--                    <div class="product-reviews">-->
<!--                      <div class="review-star">-->
<!--                        <div class="star" style="width: 80%;"></div>-->
<!--                      </div>-->
<!--                    </div>-->
                    <div class="product-prices">
<!--                      <span class="old-price">$35.90</span>-->
<!--                      <span class="sale-price">$28.72</span>-->
<!--                      <span class="discount-percentage">Save 20%</span>-->
                    </div>
                    <div class="product-cart">
                      <button class="btn btn-primary btn-hover-dark add-cart">加入購物車</button>
                    </div>
                  </div>
                </div>
                <a href="javascript:void(0)" class="compare-remove">移除</a>
              </div>
            </td>`;
              $("#product").append(product);

            });
        }

        $("body").on("click", ".compare-remove", function () {
            // console.log(this);
            let product_id= $(this).closest("td").attr("data-product_id");
            console.log(product_id);
            let compareList = JSON.parse(localStorage.getItem("compareList"));
            compareList.forEach(function(item, index, arr) {
                if(item == product_id) {
                    arr.splice(index, 1);
                }
            });
            localStorage.setItem("compareList", JSON.stringify(compareList))
            console.log(compareList);
            $(`td[data-product_id=${product_id}]`).remove();
            updateCompareNumber();
            // $('li[data-item_id=' + item_id + ']')
        })


        $(".removeAll").click(function () {
            let compareList=[];
            localStorage.setItem("compareList", JSON.stringify(compareList));
            $(`td[data-product_id]`).remove();
            updateCompareNumber();
        });

        // removeCompareList(1);
        // removeCompareList(2);
        // removeCompareList(3);
        // addCompareList(6);
        // addCompareList(8);
        // addCompareList(9);
        // addCompareList(10);
        function addCompareList(product_id){
            let compareList = JSON.parse(localStorage.getItem("compareList"));
            if(compareList==null ) {
                compareList=[product_id];
                localStorage.setItem("compareList", JSON.stringify(compareList));
                return true;
            }else{
                if(compareList.length>=3) return false;
                compareList.push(product_id);
                localStorage.setItem("compareList", JSON.stringify(compareList));
                return true;
            }
        }

        // removeCompareList(3);
        function removeCompareList(product_id){
            let compareList = JSON.parse(localStorage.getItem("compareList"));
            if(compareList==null ) return true;
            compareList.forEach(function(item, index, arr) {
                if(item == product_id) {
                    arr.splice(index, 1);
                }
            });
            localStorage.setItem("compareList", JSON.stringify(compareList));
            console.log(compareList);
            return true;
        }



    });




    // 加入購物車
    $("body").on("click", ".add-cart", function(){
        let product_id= $(this).closest("td").attr("data-product_id");
        // API要給id 跟數量 如果頁面沒有數量可以選 設為1
        $.post("/dessert_shop/cart/insertProductIntoCart?product_id="+product_id+"&product_quantity=1",{},function(data){
            console.log("加入購物車回傳的flag:"+data.flag);
            if(data.flag == false){
                Swal.fire({
                    title: data.msg,
                    text: "請先登入帳號!",
                    icon: "error"
                }).then(function(){
                    location.href="login.html";
                });
            }else {
                Swal.fire({
                    title: "已加入購物車",
                    text: "",
                    icon: "success"
                })
                cartQty();
            }
        });//$.post
    });

</script>


</body>

</html>

<!DOCTYPE html>
<html lang="zh-Hant">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <META HTTP-EQUIV="pragma" CONTENT="no-cache">
  <META HTTP-EQUIV="Cache-Control" CONTENT="no-cache, must-revalidate">
  <META HTTP-EQUIV="expires" CONTENT="0">
  <title>嗜甜-我的帳號</title>
  <meta name="robots" content="noindex, follow"/>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <!-- Favicon -->
  <link rel="shortcut icon" type="image/x-icon" href="assets/images/favicon.png">

  <!-- CSS
============================================ -->

  <!-- Icon Font CSS -->
  <link rel="stylesheet" href="assets/css/plugins/ionicons.min.css">
  <link rel="stylesheet" href="assets/css/plugins/line-awesome.min.css">
  <link rel="stylesheet" href="assets/css/plugins/fontawesome.min.css">

  <!-- Plugins CSS -->
  <link rel="stylesheet" href="assets/css/plugins/animate.min.css">
  <link rel="stylesheet" href="assets/css/plugins/swiper-bundle.min.css">
  <link rel="stylesheet" href="assets/css/plugins/nice-select.css">
  <link rel="stylesheet" href="assets/css/plugins/select2.min.css">
  <link rel="stylesheet" href="assets/css/plugins/jquery-ui.min.css">
  <link rel="stylesheet" href="assets/css/plugins/magnific-popup.css">

  <!-- Main Style CSS -->
  <link rel="stylesheet" href="assets/css/style.css">
  <link rel="stylesheet" href="assets/css/custom.css">

  <!--====== Use the minified version files listed below for better performance and remove the files listed above ======-->
  <!-- <link rel="stylesheet" href="assets/css/vendor/plugins.min.css">
  <link rel="stylesheet" href="assets/css/style.min.css"> -->
  <!-- Modernizer & jQuery JS -->
  <script src="assets/js/vendor/modernizr-3.11.2.min.js"></script>
  <script src="assets/js/vendor/jquery-3.5.1.min.js"></script>
  <script src="assets/js/vendor/jquery.waitforimages.min.js"></script>
  <script src="assets/js/plugins/sweetalert2.all.min.js"></script>
  <style>
      #member_photo {
          max-height: 200px;
      }
      #bindLine{
          margin-top:20px;
      }
      button.submit{
          margin-top:20px;
      }
  </style>
</head>

<body>
<!-- Loading Progress
============================================= -->
<div id="loading-progress">
  <a class="logo" href="#">
    <img src="assets/images/logo.jpg" data-logo-alt="images/files/logo-header.png" alt="">
    <!--        <h3><span class="colored">Astron</span></h3>-->
    <!--        <span>HTML Template</span>-->
  </a><!-- .logo end -->
  <div class="lp-content">
    <div class="lp-counter">
      Loading
      <div id="lp-counter">0%</div>
    </div><!-- .lp-counter end -->
    <div class="lp-bar">
      <div id="lp-bar"></div>
    </div><!-- .lp-bar end -->
  </div><!-- .lp-content end -->
</div>
<!-- #loading-progress end -->

<div class="main-wrapper">

  <!--Header-->
  <div class="header"></div>

  <!--Page Banner Start-->
  <div class="section page-banner-wrapper bg-cover" style="background-image: url(assets/images/page-banner.jpg);">
    <div class="container">
      <div class="page-banner">
        <ul class="breadcrumb justify-content-center">
          <li class="breadcrumb-item"><a href="index.html">Home</a></li>
          <li class="breadcrumb-item active">My Account</li>
        </ul>
      </div>
    </div>
  </div>
  <!--Page Banner Start-->

  <!-- My Account Section Start -->
  <div class="section section-padding-02 mt-n6">
    <div class="container">
      <div class="row">
        <div class="col-xl-3 col-md-4">
          <!-- My Account Menu Start -->
          <div class="my-account-menu mt-6">
            <ul class="nav account-menu-list flex-column">
              <li>
                <a data-bs-toggle="pill" href="#pills-dashboard"><i
                        class="fa fa-tachometer"></i> 導覽</a>
              </li>
              <li>
                <a data-bs-toggle="pill" href="#pills-order"><i class="fa fa-shopping-cart"></i>
                  訂單資訊</a>
              </li>
              <li>
                <a href="member-comment.html" class="member-comment"><i class="fa fa-sign-out"></i> 我的評價</a>
<!--                <a data-bs-toggle="pill" href="#pills-download"><i class="fa fa-cloud-download"></i>-->
<!--                  下載(用不到)</a>-->
              </li>
              <li>
                <a data-bs-toggle="pill" href="#pills-payment"><i class="fa fa-credit-card"></i>
                  信用卡資訊</a>
              </li>
              <li>
                <a data-bs-toggle="pill" href="#pills-address"><i class="fa fa-map-marker"></i> 地址(用不到)</a>
              </li>
              <li>
                <a class="active" data-bs-toggle="pill" href="#pills-account"><i class="fa fa-user"></i>
                  帳號詳細資訊</a>
              </li>
              <li>
                <a href="javascript:void(0)" class="logout"><i class="fa fa-sign-out"></i> 登出</a>
              </li>
            </ul>
          </div>
          <!-- My Account Menu End -->
        </div>
        <div class="col-xl-9 col-md-8">
          <!-- Tab content start -->
          <div class="tab-content my-account-tab mt-6">
            <div class="tab-pane fade" id="pills-dashboard">
              <div class="my-account-dashboard account-wrapper">
                <h4 class="account-title">Dashboard</h4>
                <div class="welcome-dashboard">
                  <p>Hello, <strong>Alex Tuntuni</strong> (If Not <strong>Tuntuni !</strong> <a
                          href="login.html">Logout</a> )</p>
                </div>
                <p class="mt-25">From your account dashboard. you can easily check & view your recent
                  orders, manage your shipping and billing addresses and edit your password and
                  account details.</p>
              </div>
            </div>

            <div class="tab-pane fade" id="pills-order">
              <div class="my-account-order account-wrapper">
                <h4 class="account-title">Orders</h4>
                <div class="account-table text-center mt-30 table-responsive">
                  <table class="table">
                    <thead>
                    <tr>
                      <th class="no">No</th>
                      <th class="name">Name</th>
                      <th class="date">Date</th>
                      <th class="status">Status</th>
                      <th class="total">Total</th>
                      <th class="action">Action</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                      <td>1</td>
                      <td>Mostarizing Oil</td>
                      <td>Aug 22, 2020</td>
                      <td>Pending</td>
                      <td>$100</td>
                      <td><a href="#">View</a></td>
                    </tr>
                    <tr>
                      <td>2</td>
                      <td>Katopeno Altuni</td>
                      <td>July 22, 2020</td>
                      <td>Approved</td>
                      <td>$45</td>
                      <td><a href="#">View</a></td>
                    </tr>
                    <tr>
                      <td>3</td>
                      <td>Murikhete Paris</td>
                      <td>June 22, 2020</td>
                      <td>On Hold</td>
                      <td>$99</td>
                      <td><a href="#">View</a></td>
                    </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>

            <div class="tab-pane fade" id="pills-download">
              <div class="my-account-download account-wrapper">
                <h4 class="account-title">Download</h4>
                <div class="account-table text-center mt-30 table-responsive">
                  <table class="table">
                    <thead>
                    <tr>
                      <th class="name">Product</th>
                      <th class="date">Date</th>
                      <th class="status">Expire</th>
                      <th class="action">Download</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                      <td>Mostarizing Oil</td>
                      <td>Aug 22, 2020</td>
                      <td>Yes</td>
                      <td><a href="#">Download File</a></td>
                    </tr>
                    <tr>
                      <td>Katopeno Altuni</td>
                      <td>July 22, 2020</td>
                      <td>Never</td>
                      <td><a href="#">Download File</a></td>
                    </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>

            <div class="tab-pane fade" id="pills-payment">
              <div class="my-account-payment account-wrapper">
                <h4 class="account-title">Payment Method</h4>
                <p class="mt-30">You Can't Saved Your Payment Method yet.</p>
              </div>
            </div>

            <div class="tab-pane fade" id="pills-address">
              <div class="my-account-address account-wrapper">
                <div class="row">
                  <div class="col-md-6">
                    <h4 class="account-title">Billing address</h4>
                    <div class="account-address mt-30">
                      <h6 class="name">Alex Tuntuni</h6>
                      <p>1355 Market St, Suite 900 <br> San Francisco, CA 94103</p>
                      <p>Mobile: (123) 456-7890</p>
                      <a class="btn btn-primary btn-hover-dark" href="#"><i
                              class="fa fa-edit"></i> Edit Address</a>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <h4 class="account-title">Shipping address</h4>
                    <div class="account-address mt-30">
                      <h6 class="name">Alex Tuntuni</h6>
                      <p>1355 Market St, Suite 900 <br> San Francisco, CA 94103</p>
                      <p>Mobile: (123) 456-7890</p>
                      <a class="btn btn-primary btn-hover-dark" href="#"><i
                              class="fa fa-edit"></i> Edit Address</a>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="tab-pane fade show active" id="pills-account">
              <div class="my-account-details account-wrapper">
                <h4 class="account-title">個人資料</h4>

                <div class="account-details">
                  <form id="update_form" action="javascript:void(0)" enctype="multipart/form-data">
                    <div class="row">
                      <div class="col-md-12">
                        <div class="single-form preview">
                          <img class="img-fluid " id="member_photo"
                               src="assets/images/logo.jpg"
                               data-logo-alt="images/files/logo-header.png" alt="">
                          <br>
                        </div>
                        <div>
                          <input type="file" name="upfile" id="p_file">
                          <!--<input type="text" class="form-control" name="member_name">-->
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="single-form">
                          <label class="form-label">姓名</label>
                          <input type="text" class="form-control" name="member_name">
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="single-form">
                          <label class="form-label">帳號</label>
                          <input type="text" class="form-control" name="member_account"
                                 value="123" disabled="disabled">
                          <!--<label class="form-label" id="member_account"></label>-->
                        </div>
                      </div>
                      <div class="col-md-12">
                        <div class="single-form">
                          <label class="form-label">手機</label>
                          <input type="text" class="form-control" name="member_phone">
                        </div>
                      </div>
                      <div class="col-md-12">
                        <div class="single-form">
                          <label class="form-label">信箱</label>
                          <input type="text" class="form-control" name="member_email">
                        </div>
                      </div>
                      <div class="col-md-12">
                        <label class="form-label">性別</label><br>
                        <input class="form-check-input" type="radio" name="member_gender"
                               id="radio1" value="1" checked>
                        <label for="radio1"><span></span>男</label>
                        <input class="form-check-input" type="radio" name="member_gender"
                               id="radio2" value="0">
                        <label for="radio2"><span></span>女</label>
                      </div>
                      <div class="col-md-12">
                        <div class="single-form">
                          <label class="form-label">生日</label>
                          <input type="date" class="form-control" name="member_birthday">
                        </div>
                      </div>
                      <div class="col-md-12">
                        <div class="single-form">
                          <button class="btn btn-primary btn-hover-dark submit">儲存修改</button>
                        </div>
                        <div>
                          <button class="btn btn-primary btn-hover-dark" id="bindLine">綁定Line帳號</button>
                        </div>
                      </div>
                      <input type="hidden" name="member_account" value="">
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
          <!-- Tab content End -->
        </div>
      </div>
    </div>
  </div>
  <!-- My Account Section End -->

  <!--Footer-->
  <div class="footer"></div>

</div>


<!-- JS
============================================ -->

<!-- Bootstrap JS -->
<script src="assets/js/plugins/popper.min.js"></script>
<script src="assets/js/plugins/bootstrap.min.js"></script>

<!-- Plugins JS -->
<script src="assets/js/plugins/swiper-bundle.min.js"></script>
<script src="assets/js/plugins/jquery.nice-select.min.js"></script>
<script src="assets/js/plugins/select2.min.js"></script>
<script src="assets/js/plugins/jquery-ui.min.js"></script>
<script src="assets/js/plugins/jquery.magnific-popup.min.js"></script>
<script src="assets/js/plugins/jquery.zoom.min.js"></script>
<script src="assets/js/plugins/ajax-contact.js"></script>

<!--====== Use the minified version files listed below for better performance and remove the files listed above ======-->
<!-- <script src="assets/js/plugins.min.js"></script> -->


<!-- Main JS -->
<script src="assets/js/main.js"></script>
<script src="assets/js/moment.js"></script>
<script>
    $(document).ready(function () {
        $('.header').load('header.html')
        $('.footer').load('footer.html')
    })

    $("body").waitForImages({
        finished: function () {
            setTimeout(function () {
                $(".lp-content, #loading-progress .logo").css({opacity: 0})
                $("#loading-progress").addClass("hide-it"),
                    setTimeout(function () {
                        $(".banner-parallax > .bg-element, .banner-parallax > .overlay-pattern").addClass("appeared")
                    }, 1000)
            }, 0)
        }, each: function (a, t, e) {
            var n = Math.floor((a + 1) / t * 100);
            $("#lp-counter").animate({$this: n}, {
                duration: 150, easing: "", queue: !1, step: function (a) {
                    var t = Math.round(a);
                    $("#lp-counter").text(t + "%")
                }
            }), $("#lp-bar").animate({width: n + "%"}, 0)
        }, waitForAll: !0
    });
</script>
<script>

    $(function () {
        $.get("/dessert_shop/member/isLogin", {}, function (data) {
            console.log(data);
            if (data.flag) {
                // alert("帳號:" + data.data.member_account + "\n姓名:" + data.data.member_name + "\n密碼:" + data.data.member_password);
                // console.log(data.data);
                // if(data.redirect)
                //     location.href = data.redirect;
                $('#member_account').val(data.data.member_account);
                $('input[name="member_account"]').val(data.data.member_account);
                $('input[name="member_name"]').val(data.data.member_name);
                $('input[name="member_phone"]').val(data.data.member_phone);
                $('input[name="member_email"]').val(data.data.member_email);
                data.data.member_gender == 1 ? $('#radio1').prop('checked', true) : $('#radio2').prop('checked', true);
                // $('input[name="member_gender"]').val(data.data.member_gender);
                $('input[name="member_birthday"]').val(moment(data.data.member_birthday).format('YYYY-MM-DD'));
                $('#member_photo').attr('src', "/dessert_shop/member/backend_getPhoto?id=" + data.data.member_account)

            } else {
            }
        });


        //表單送出時
        // $("#update_form").submit(function (e) {
        $("button.submit").click(function (e) {
            e.preventDefault();
            //表單提交時檢查所有屬性合法
            // if(checkUsername() && checkPassword() && checkEmail()){
            //發送ajax請求，送出表單資料
            console.log($("#update_form").serialize());

            let form = $('#update_form')[0];
            let data = new FormData(form);
            $.ajax({
                type: "POST",
                enctype: 'multipart/form-data',
                url: '/dessert_shop/member/update',
                data: data,
                processData: false,
                contentType: false,
                cache: false,
                success: function (data) {
                    if (data.flag) {
                        // 註冊成功後跳轉頁面
                        // location.href="register_ok.html";
                        Swal.fire({
                            title: data.msg,
                            text: "",
                            icon: "success"
                        });
                        let url = location.href.split("/TEA103G2")[0];
                        $("i.la-user").css('display', 'none');
                        $("img.user_icon").css('display', 'inline-block');
                        $('img.user_icon').attr("src", $('img.preview_img').attr("src"));
                    } else {
                        // 註冊失敗 彈出視窗
                        Swal.fire({
                            title: data.msg,
                            text: "",
                            icon: "error"
                        })
                    }
                }
            });
            return false;
        });

        $('.logout').click(function () {
            $.get("/dessert_shop/member/logout", {}, function (data) {
                console.log(data);
                if (data.flag) {
                    if (data.redirect)
                        location.href = data.redirect;
                } else {
                    Swal.fire({
                        title: '登出失敗',
                        text: '',
                        icon: "error"
                    })
                }
            });
        })


        //以下上傳大頭貼
        const p_file = document.getElementById("p_file");
        p_file.addEventListener("change", function (e) {
            handleFiles(this.files);
        });

        const preview = document.getElementsByClassName("preview")[0];

        //檔案上傳的處理函式
        function handleFiles(files) {
            //先刪掉預覽圖裡的img
            while (preview.firstChild) preview.removeChild(preview.lastChild);

            // 跑每個使用者選的檔案
            for (let i = 0; i < files.length; i++) {
                let file = files[i];
                let imageType = /image.*/;
                // 判斷檔案的類型，圖片才加載
                if (!file.type.match(imageType)) {
                    continue;
                }
                //增加img節點在預覽圖裡面
                let img = document.createElement("img");
                img.classList.add("preview_img");
                img.setAttribute("id", "member_photo")
                preview.appendChild(img);

                let reader = new FileReader();
                // reader.onload = (e => img.src = reader.result);  //監聽器 檔案讀完的事件 設定img的src
                reader.addEventListener("load", function (e) {
                    img.src = reader.result.toString();
                })
                reader.readAsDataURL(file);  //讀取檔案
            }
        }


        $("#bindLine").click(function () {
            Swal.fire({
                title: '掃描QRCode',
                text: '將密文傳到嗜甜Line官方帳號即可完成綁定',
                imageUrl: '/dessert_shop/member/getLineQRCode?' + new Date().getTime(),
                imageWidth: 200,
                imageHeight: 200,
                imageAlt: 'Custom image',
            });

            Swal.mixin({
                confirmButtonText: 'Next &rarr;',
                showCancelButton: true,
                progressSteps: ['1', '2']
            }).queue([
                {
                    title: '請先加入嗜甜Line官方帳號',
                    text: '',
                    imageUrl: 'https://qr-official.line.me/sid/L/322ganxg.png',
                    imageWidth: 200,
                    imageHeight: 200,
                    imageAlt: 'Custom image',
                },
                {
                    title: '將密文傳到官方帳號\n即可完成綁定',
                    text: '有效期限:30分鐘',
                    imageUrl: '/dessert_shop/member/getLineQRCode?' + new Date().getTime(),
                    imageWidth: 200,
                    imageHeight: 200,
                    imageAlt: 'Custom image',
                }
            ])
        });
    });
</script>
</body>

</html>

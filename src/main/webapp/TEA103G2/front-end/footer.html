<!DOCTYPE html>
<html lang="zh-Hant">

<!--<head>-->
<!--    <meta charset="utf-8">-->
<!--    <meta http-equiv="x-ua-compatible" content="ie=edge">-->
<!--    <title>Amino - Organic & Multipurpose Bootstrap 5 Template</title>-->
<!--    <meta name="robots" content="noindex, follow"/>-->
<!--    <meta name="description" content="">-->
<!--    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">-->
<!--    &lt;!&ndash; Favicon &ndash;&gt;-->
<!--    <link rel="shortcut icon" type="image/x-icon" href="assets/images/favicon.png">-->

<!--    &lt;!&ndash; CSS-->
<!--	============================================ &ndash;&gt;-->

<!--    &lt;!&ndash; Icon Font CSS &ndash;&gt;-->
<!--    <link rel="stylesheet" href="assets/css/plugins/ionicons.min.css">-->
<!--    <link rel="stylesheet" href="assets/css/plugins/line-awesome.min.css">-->
<!--    <link rel="stylesheet" href="assets/css/plugins/fontawesome.min.css">-->

<!--    &lt;!&ndash; Plugins CSS &ndash;&gt;-->
<!--    <link rel="stylesheet" href="assets/css/plugins/animate.min.css">-->
<!--    <link rel="stylesheet" href="assets/css/plugins/swiper-bundle.min.css">-->
<!--    <link rel="stylesheet" href="assets/css/plugins/nice-select.css">-->
<!--    <link rel="stylesheet" href="assets/css/plugins/select2.min.css">-->
<!--    <link rel="stylesheet" href="assets/css/plugins/jquery-ui.min.css">-->
<!--    <link rel="stylesheet" href="assets/css/plugins/magnific-popup.css">-->

<!--    &lt;!&ndash; Main Style CSS &ndash;&gt;-->
<!--    <link rel="stylesheet" href="assets/css/style.css">-->


<!--    &lt;!&ndash;====== Use the minified version files listed below for better performance and remove the files listed above ======&ndash;&gt;-->
<!--    &lt;!&ndash; <link rel="stylesheet" href="assets/css/vendor/plugins.min.css">-->
<!--    <link rel="stylesheet" href="assets/css/style.min.css"> &ndash;&gt;-->
<!--    <script src="assets/js/vendor/modernizr-3.11.2.min.js"></script>-->
<!--    <script src="assets/js/vendor/jquery-3.5.1.min.js"></script>-->
<!--</head>-->

<body>
    <!-- Footer Start-->
    <div class="section footer-section">

        <!-- Footer widget Start -->
        <div class="footer-widget-wrapper" style="padding:15px 0 50px 0 ">
            <div class="container">
                <div class="row" style="padding-right: 0">


                    <div class="col-lg-4" style="margin-right:50px">
                        <!-- Footer widget Start -->
                        <div class="footer-widget">
                            <div class="footer-newsletter" style="padding-top:10px; padding-right:50px;width:240px">
                                <img class="footer-logo" src="assets/images/sweet2.png">
                            </div>
                        </div>
                        <!-- Footer widget End -->
                    </div>


                    <div class="col-lg-3 col-sm-6" style="margin-right:50px">
                        <!-- Footer widget Start -->
                        <div class="footer-widget">
                            <h4 class="footer-widget-title" style="margin-bottom:10px">店家資訊</h4>

                            <div class="desc-info">

                                <div class="info-items">

                                    <div class="single-info">
                                        <i class="la la-clock-o"></i>
                                        <p>Mon-Fri 10:00-20:00<br>Sat-Sun 10:00-18:00</p>
                                    </div>

                                    <div class="single-info">
                                        <i class="las la-phone-volume"></i>
                                        <p>(02)2712-0589</p>
                                    </div>

                                    <div class="single-info">
                                        <i class="las la-map-marker"></i>
                                        <p>台北市中山區南京東路三段219號5樓</p>
                                    </div>

                                </div>

                            </div>
                        </div>
                        <!-- Footer widget End -->
                    </div>


                    <div class="col-lg-2 col-sm-3 col-6">
                        <!-- Footer widget Start -->
                        <div class="footer-widget">
                            <h4 class="footer-widget-title" style="margin-bottom:10px">關於我們</h4>

                            <ul class="widget-link" style="padding-left:8px">
                                <li><a href="about.html">關於我們</a></li>
                                <li><a href="contact.html">聯絡資訊</a></li>
                                <li><a href="blog-grid.html">最新消息</a></li>
                            </ul>
                        </div>
                        <!-- Footer widget End -->
                    </div>


                    <div class="col-lg-4 col-sm-6 col-6">
                        <!-- Footer widget Start -->
                        <div class="footer-widget">
                            <div class="footer-subscriber">

                                <h4 class="footer-widget-title" style="margin-bottom:10px">訂閱我們<i class="la la-envelope" style="font-size:20px;margin-left:5px"></i></h4>

                                <p>訂閱關注最新消息</p>
                                <div class="subscriber">
                                    <input name="subscriber_email" class="subscriber_email" type="text"
                                        placeholder="請輸入電子郵件..." onkeydown="if(event.keyCode==13) subscriber();">
                                    <button type="submit" class="send_subscriber_email" onclick="subscriber()">訂閱</button>
                                </div>

                            </div>
                        </div>
                        <!-- Footer widget End -->
                    </div>


                </div>
            </div>
        </div>
        <!-- Footer widget End -->

        <!-- Footer Copyright Start -->
        <div class="footer-copyright" style="padding-bottom:0">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12">

                        <!-- Copyright and payment Start -->
                        <div class="copyright-payment" style="display: inline-flex; margin-left:300px">
                            <div class="payment">
                                <img src="assets/images/payment.png" alt="Payment">
                            </div>
                            <div class="copyright">
                                <p> Copyright © <a href="https://sweetness.tw">Sweetness</a>. All rights reserved.</p>
                            </div>
                        </div>
                        <!-- Copyright and payment End -->
                    </div>
                </div>
            </div>
        </div>
        <!-- Footer Copyright End -->

    </div>
    <!-- Footer End-->


    <!--------------------------------------------------- LiveSupport --------------------------------------------------->

    <div class="message-btn" type="button">
        <img class="message-btn-img" src="assets/images/icon/messenger.png">
    </div>

    <div class="message-table">
        <div class="message-title">
            <div class="message-title-name">Sweetness</div><button class="message-close"><img class="message-close-img"
                    src="assets/images/icon/cancel.png"></button>
        </div>
        <div id="messagesArea" class="panel message-area">
            <!--             <ul id="area"> -->
            <!-- <li class="message-li-friend">我是朋友我是朋友我是朋友我是朋友我是朋友我是朋友我是朋友</li>
                <li class="message-li-me">我是自己我是自己我是自己我是自己我是自己我是自己我是自己</li>
                <li class="message-li-friend">我是朋友</li>
                <li class="message-li-me">我是自己</li> -->
            <!--             </ul> -->
        </div>
        <div class="panel input-area">
            <input id="message" type="text" class="text-field" placeholder="請輸入訊息..."
                onkeydown="if(event.keyCode==13) sendMessage();" />
            <button type="submit " id="sendMessage" class="send-message-button" value="Send" onclick="sendMessage()">
                <img class="send-message-img" src="assets/images/icon/icon-send.png">
            </button>
        </div>

    </div>




    <!------------------------------------------------------------------------------------------------------------------->
    <!--Back To Start-->
    <a href="#" class="back-to-top">
        <i class="las la-arrow-up"></i>
    </a>
    <!--Back To End-->


    <!-- JS ============================================ -->


    <!-- Bootstrap JS -->
    <!--<script src="assets/js/plugins/popper.min.js "></script>-->
    <!--<script src="assets/js/plugins/bootstrap.min.js "></script>-->

    <!-- Plugins JS -->
    <!--<script src="assets/js/plugins/swiper-bundle.min.js "></script>-->
    <!--<script src="assets/js/plugins/jquery.nice-select.min.js "></script>-->
    <!--<script src="assets/js/plugins/select2.min.js "></script>-->
    <!--<script src="assets/js/plugins/jquery-ui.min.js "></script>-->
    <!--<script src="assets/js/plugins/jquery.magnific-popup.min.js "></script>-->
    <!--<script src="assets/js/plugins/jquery.zoom.min.js "></script>-->
    <!--<script src="assets/js/plugins/ajax-contact.js "></script>-->
    <!--====== Use the minified version files listed below for better performance and remove the files listed above ======-->
    <!-- <script src="assets/js/plugins.min.js "></script> -->


    <!-- Main JS -->
    <!--<script src="assets/js/main.js "></script>-->

    <script>
        $.post("/dessert_shop/member/isLogin", function (response) {
            if (response.flag) {

                /********************************** webSocket **********************************/
                var MyPoint = "/FriendWS2/" + response.data.member_account; //登入的帳號
                var host = window.location.host;
                var path = window.location.pathname;
                var webCtx = path.substring(0, path.indexOf('/', 1));
                //websocket 有自己的通訊協定(ws) 同等於http (ws://localhost:8081/WebSocketChatWeb/TogetherWS/james)
                var endPointURL = "ws://" + window.location.host + webCtx + MyPoint;
                webSocket = new WebSocket(endPointURL);

                var self = response.data.member_account;


                //建立連線
                webSocket.onopen = function (e) {
                    console.log(response.data.member_account + "客服連線開啟");

                }

                //接收訊息
                webSocket.onmessage = function (e) {

                    var jsonObj = JSON.parse(e.data);
                    console.log(jsonObj);
                    console.log(jsonObj.type);

                    addListener();


                    if ("history" == jsonObj.type) {


                        $('#messagesArea').html('');
                        $('#messagesArea').append(`<ul id="area"></ul>`)

                        var message = JSON.parse(jsonObj.message);

                        console.log(message);

                        for (var i in message) {

                            console.log(message[i]);
                            console.log(message[i].sender);


                            var historyData = JSON.parse(message[i]);
                            console.log("historyData" + historyData);

                            var showMsg = historyData.message;
                            console.log("showMsg" + showMsg);
                            var whose = historyData.sender == self ? 'me' : 'friend';
                            $('#area').append(`<li class="message-li-` + whose + `">` + showMsg + `</li>`)
                            console.log(whose + "=>" + showMsg);

                        }

                        $('#messagesArea').scrollTop(520);
                    } else if ("chat" == jsonObj.type) {

                        var whose = jsonObj.sender == self ? 'me' : 'friend';
                        $('#area').append(`<li class="message-li-` + whose + `">` + jsonObj.message + `</li>`)

                    }

                    $('#messagesArea').scrollTop(520);
                }

                //發生錯誤
                webSocket.onerror = function (e) {
                    console.log("錯誤訊息:", e);
                };

                //關閉連線
                webSocket.onclose = function (e) {
                    console.log("客服連線關閉");
                }

            } else { }


        });

        /*======================================= MessageLightBox =======================================*/
        // 開啟 Modal 彈跳視窗
        $("div.message-btn").on("click ", function () {
            $("div.message-table").toggle();
        });

        // 關閉 Modal
        $("button.message-close").on("click ", function () {
            $("div.message-table").toggle();
        });

        /******************************* 通知滑鼠移入變色 *******************************/
        $('img.message-close-img').on('mouseover', function () {
            this.src = "assets/images/icon/cancel2.png";
        });
        $('img.message-close-img').on('mouseout', function () {
            this.src = "assets/images/icon/cancel.png";
        });

        /********************************** Function **********************************/

        function sendMessage() {

            $.post("/dessert_shop/member/isLogin", function (response) {

                var inputMessage = $('#message');
                var message = $.trim($('#message').val());
                var friend = 'james';
                var self = response.data.member_account;


                if (message == "") {

                    alert("請輸入資料");
                    $('#message').focus();

                } else {

                    var dataObj = {
                        "type": "chat",
                        "sender": self,
                        "receiver": friend,
                        "message": message
                    }

                    webSocket.send(JSON.stringify(dataObj));
                    inputMessage.val("");
                    inputMessage.focus();


                    console.log(dataObj);

                }
            })
        }

        // addListener(jsonObj);
        function addListener() {
            $('.message-btn').on("click", function () {

                $.post("/dessert_shop/member/isLogin", function (response) {
                    if (response.flag) {
                        var self = response.data.member_account;
                        var friend = 'james';

                        var jsonObj = {
                            "type": "history",
                            "sender": self,
                            "receiver": friend,
                            "message": ""
                        };

                        console.log(jsonObj);
                        webSocket.send(JSON.stringify(jsonObj));

                    } else { }
                })
            })
        }
    </script>

    <!------------------------------- 訂閱的部分 ------------------------------->
    <script>
        function subscriber() {
            $('.send_subscriber_email').on("click", function () {
                let inputSubMsg = $('.subscriber_email');
                let SubMsg = $.trim(inputSubMsg.val());
                let reg = /^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z]+$/;
                if (SubMsg == "") {
                    Swal.fire({
                        text: "內容請勿空白，謝謝!",
                        icon: "error"
                    });
                } else {
                    if (reg.test(SubMsg) != true) {
                        console.log(SubMsg);
                        Swal.fire({
                            text: "注意郵件格式是否正確!",
                            icon: "error"
                        });
                    } else {
                        $.post("/dessert_shop/subscriberList/addSubscriberList?", { "subscriber_email": SubMsg }, function (data) {
                            if (data.flag) {
                                console.log(SubMsg);
                                Swal.fire({
                                    title: data.msg,
                                    text: "歡迎加入訂閱",
                                    icon: "success"
                                });
                            }
                        })
                        inputSubMsg.val('');
                    }
                }
            })
        }
    </script>
</body>

</html>
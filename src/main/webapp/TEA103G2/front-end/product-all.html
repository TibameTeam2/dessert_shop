<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<title>Amino - Organic & Multipurpose Bootstrap 5 Template</title>
<meta name="robots" content="noindex, follow" />
<meta name="description" content="">
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no">
<!-- Favicon -->
<link rel="shortcut icon" type="image/x-icon"
	href="assets/images/favicon.png">

<!-- CSS
	============================================ -->

<!-- Icon Font CSS -->
<link rel="stylesheet" href="assets/css/plugins/ionicons.min.css">
<link rel="stylesheet" href="assets/css/plugins/line-awesome.min.css">
<link rel="stylesheet" href="assets/css/plugins/fontawesome.min.css">

<!-- Plugins CSS -->
<link rel="stylesheet" href="assets/css/plugins/animate.min.css">
<link rel="stylesheet" href="assets/css/plugins/swiper-bundle.min.css">
<link rel="stylesheet" href="assets/css/plugins/nice-select.css">
<link rel="stylesheet" href="assets/css/plugins/select2.min.css">
<link rel="stylesheet" href="assets/css/plugins/jquery-ui.min.css">
<link rel="stylesheet" href="assets/css/plugins/magnific-popup.css">

<!-- Main Style CSS -->
<link rel="stylesheet" href="assets/css/style.css">
<link rel="stylesheet" href="assets/css/custom.css">


<!--====== Use the minified version files listed below for better performance and remove the files listed above ======-->
<!-- <link rel="stylesheet" href="assets/css/vendor/plugins.min.css">
    <link rel="stylesheet" href="assets/css/style.min.css"> -->



<!-- 分享按鈕 from SHARETHIS -->
<script type="text/javascript" src="https://platform-api.sharethis.com/js/sharethis.js#property=6073dff91ec66e0011e92ec0&product=inline-share-buttons" async="async"></script>
<!-- 分享按鈕結束 -->

<style>
	/*a.compare.-on{*/
	/*	background-color:#83bc2e;*/
	/*	color:#fff;*/
	/*}*/
	/*a.compare{*/
	/*	background-color:#fff;*/
	/*	color:#000;*/
	/*}*/
</style>
</head>

<body>
	<!-- Loading Progress ============================================= -->
	<div id="loading-progress">
		<img src="assets/images/sweetness_logo.png" data-logo-alt="images/files/logo-header.png" alt="">
			<!--        <h3><span class="colored">Astron</span></h3>-->
			<!--        <span>HTML Template</span>-->
		</a>
		<!-- .logo end -->
		<div class="lp-content">
			<div class="lp-counter">
				Loading
				<div id="lp-counter">0%</div>
			</div>
			<!-- .lp-counter end -->
			<div class="lp-bar">
				<div id="lp-bar"></div>
			</div>
			<!-- .lp-bar end -->
		</div>
		<!-- .lp-content end -->
	</div>
	<!-- #loading-progress end -->


	<div class="main-wrapper">
	
		<!--Header-->
		<div class="header"></div>

		<!--Page Banner Start-->
		<div class="section page-banner-wrapper bg-cover"
			style="background-image: url(assets/images/page-banner.jpg);">
			<div class="container">
				<div class="page-banner">
					<ul class="breadcrumb justify-content-center">
						<li class="breadcrumb-item"><a href="index.html">Home</a></li>
						<li class="breadcrumb-item active">Shop</li>
					</ul>
				</div>
			</div>
		</div>
		<!--Page Banner Start-->

		<!--Shop Start-->
		<div class="section section-padding-02 mt-n8">
			<div class="container">
				<!-- Shop Top Bar Start -->
				<div class="shop-top-bar mt-6">
					<ul class="nav">
						<li><a class="active" data-bs-toggle="tab" href="#grid"><i
								class="fas fa-th"></i></a></li>
						<li><a data-bs-toggle="tab" href="#list"><i
								class="far fa-list-ul"></i></a></li>
					</ul>

					<div class="top-bar-select">
						<span>排序:</span>
						<!-- <select class="custom-select"> -->
						<!--如果有這行 文字會無法顯示-->
						<select class="sorting">
							<option value="0" selected>最新商品</option>
							<option value="1">銷售量 高至低</option>
							<option value="2">依星等 高至低</option>
							<option value="3">依售價 高至低</option>
							<option value="4">依熱量 高至低</option>
							<option value="5">依甜度 高至低</option>
						</select>
					</div>
				</div>
				<!-- Shop Top Bar End -->

				<!-- Tab Content Start -->
				<div class="tab-content">
					<div class="tab-pane fade show active" id="grid">
						<div class="row">
						<!-- 方格商品清單 會插在這裡-->
						
						</div>
					</div>
					
					
					<!-- 條列式 -->					
					<div class="tab-pane fade" id="list">
					<!-- 條列式清單插入的位置 -->					
						
					</div>
				</div>
				<!-- Tab Content End -->

				<!-- Page pagination Start -->
				<div class="page-pagination">
					<ul class="pagination justify-content-center">
						<li class="page-item"><a class="page-link" href="#"><i
								class="las la-angle-left"></i></a></li>
						<li class="page-item"><a class="page-link" href="#">1</a></li>
						<li class="page-item"><a class="page-link active" href="#">2</a></li>
						<li class="page-item"><a class="page-link" href="#">3</a></li>
						<li class="page-item"><a class="page-link" href="#"><i
								class="las la-angle-right"></i></a></li>
					</ul>
				</div>
				<!-- Page pagination End -->
			</div>
		</div>
		<!--Shop End-->

		<!--Footer-->
		<div class="footer"></div>


	</div>


	<!-- Quick View Start -->
	<div class="modal fade" id="quick-view">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
				<button type="button" class="btn-close" data-bs-dismiss="modal"
					aria-label="Close"></button>
				<div class="modal-body">
					<div class="row">
						<div class="col-lg-6">
							<!-- Quick View image Start -->
							<div class="quick-view-image">
								<div class="quick-view-top">
									<div class="swiper-container">
										<div class="swiper-wrapper">
										<!-- 大圖插入處 -->
										
										</div>
									</div>
								</div>
								<div class="product-thumbnail quick-view-thumbs">
									<div class="swiper-container">
										<div class="swiper-wrapper">
										<!-- 下方小圖插入處 -->
										
										</div>
									</div>
									<!-- Add Arrows -->
									<div class="swiper-button-next"></div>
									<div class="swiper-button-prev"></div>
								</div>
								<div class="product-flag">
									<span class="new">New</span>
								</div>
							</div>
							<!-- Quick View image End -->
						</div>
						<div class="col-lg-6">
							<!--  Quick View Content Start -->
							<div class="quick-view-content">
								<h3 class="product-name">Juicy Couture Juicy Quilted Terry
									Track Jacket</h3>
								<p class="reference">
									Reference: <span>Demo</span>
								</p>
								<ul class="shop-rating-content">
									<li>
										<div class="review-star">
											<div class="star" style="width: 80%;"></div>
										</div>
									</li>
									<li><a href="#"><i class="fal fa-comment-dots"></i> 查看評論 <span>(3)</span></a></li>
<!-- 									<li><a href="#"><i class="fal fa-edit"></i> 撰寫評論 </a></li> -->
								</ul>
								<div class="product-prices">
									<span class="old-price">$35.90</span> <span class="sale-price">$28.72</span>
									<span class="discount-percentage">Save 20%</span>
								</div>
								<div class="product-description">
									<ul>
										<li>Block out the haters with the fresh adidas® Originals
											Kaval Windbreaker Jacket.</li>
										<li>Part of the Kaval Collection.</li>
										<li>Regular fit is eased, but not sloppy, and perfect for
											any activity.</li>
										<li>Plain-woven jacket specifically constructed for
											freedom of movement.</li>
									</ul>
								</div>
								<div class="product-quantity-cart">
									<div class="product-quantity-cart-wrapper d-flex">
										<div class="product-quantity d-inline-flex">
											<button type="button" class="sub">
												<i class="ion-ios-arrow-down"></i>
											</button>
											<input type="text" value="1" class="purchase_qty"/>
											<button type="button" class="add">
												<i class="ion-ios-arrow-up"></i>
											</button>
										</div>
										<div class="product-cart">
											<button class="btn btn-primary btn-hover-dark add-cart"> 加入購物車 </button>
										</div>
									</div>
								</div>
								<div class="product-additional-info">
									<p class="panel-product-actions">
										<a href="#" class="action-btn wishlist"><i
											class="ion-android-favorite-outline"></i> 加入收藏清單 </a>
									</p>
									<p class="panel-product-actions">
										<button class="action-btn wishlist">
											<i class="ion-ios-shuffle-strong"></i> 加入比較列表 </button>
									</p>
								</div>
								<div class="product-sharing">
									<span class="label">分享</span>
									<ul class="social-sharing">
<!-- 										<li><a href="#"><i class="ion-social-facebook"></i></a></li> -->
<!-- 										<li><a href="#"><i class="ion-social-twitter"></i></a></li> -->
<!-- 										<li><a href="#"><i class="ion-social-pinterest"></i></a></li> -->
<!-- 										<li><a href="#"><i class="ion-social-linkedin"></i></a></li> -->
										
										<!-- 分享按鈕 from SHAR THIS -->
										<li>
										<div class="sharethis-inline-share-buttons"></div>
										</li>
									</ul>
								</div>
							</div>
							<!-- Quick View Content End -->
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- Quick View End -->







	<!-- JS
    ============================================ -->

	<!-- Modernizer & jQuery JS -->
	<script src="assets/js/vendor/modernizr-3.11.2.min.js"></script>
	<script src="assets/js/vendor/jquery-3.5.1.min.js"></script>
	<script src="assets/js/vendor/jquery.waitforimages.min.js"></script>
    <script src="assets/js/plugins/sweetalert2.all.min.js"></script>

	<!-- Bootstrap JS -->
	<script src="assets/js/plugins/popper.min.js"></script>
	<script src="assets/js/plugins/bootstrap.min.js"></script>

	<!-- Plugins JS -->
	<script src="assets/js/plugins/swiper-bundle.min.js"></script>
	<script src="assets/js/plugins/jquery.nice-select.min.js"></script>
	<script src="assets/js/plugins/select2.min.js"></script>
	<script src="assets/js/plugins/jquery-ui.min.js"></script>
	<script src="assets/js/plugins/jquery.magnific-popup.min.js"></script>
	<script src="assets/js/plugins/jquery.zoom.min.js"></script>
	<script src="assets/js/plugins/ajax-contact.js"></script>

	<!--====== Use the minified version files listed below for better performance and remove the files listed above ======-->
	<!-- <script src="assets/js/plugins.min.js"></script> -->


	<!-- Main JS -->
	<script src="assets/js/main.js"></script>

	<!-- Header Footer LoadingAnimation -->
	<script>
        $(document).ready(function () {
            $('.header').load('header.html')
            $('.footer').load('footer.html')
        })

        $("body").waitForImages({
            finished: function () {
                setTimeout(function () {
                    $(".lp-content, #loading-progress .logo").css({ opacity: 0 })
                    $("#loading-progress").addClass("hide-it"),
                        setTimeout(function () {
                            $(".banner-parallax > .bg-element, .banner-parallax > .overlay-pattern").addClass("appeared")
                        }, 1000)
                }, 0)
            }, each: function (a, t, e) {
                var n = Math.floor((a + 1) / t * 100);
                $("#lp-counter").animate({ $this: n }, {
                    duration: 150, easing: "", queue: !1, step: function (a) {
                        var t = Math.round(a);
                        $("#lp-counter").text(t + "%")
                    }
                }), $("#lp-bar").animate({ width: n + "%" }, 0)
            }, waitForAll: !0
        });
   
   	</script>


<!-- 商品展示 -->
<script>
//     $(function () {

          function getParameter(param) {
              const urlParams = new URLSearchParams(window.location.search);
              return urlParams.get(param);   //取不到值時會是null
          }

       	let request_type=getParameter("type");
       	let request_subtype= getParameter("subtype");
       	console.log("轉換前:"+request_type);	
     	console.log("轉換前:"+request_subtype);	
     		
   
       	switch(request_type) {
	       	 case "cakes":
	       	 	request_type="蛋糕";
	       	 	if(request_subtype!=null){
	       	 		console.log("蛋糕裡面");
		       	 	switch(request_subtype) {
		          	 case "crepes":
		          		request_subtype="千層蛋糕";
		          	  break;
		          	 case "cupcakes":
		          		request_subtype="杯子蛋糕";
		          	  break;
		          	 case "cheesecakes":
		          		request_subtype="起士蛋糕";
		          	  break;
		          	 case "poundcakes":
		          		request_subtype="磅蛋糕";
		          	  break;
		          	 case "cakerolls":
		          		request_subtype="蛋糕捲";
		          	  break;
		          	 default:
			          // ?
		       	 	}			
	       	 	}
	       	  break;
       	 case "chocolates":
       		request_type="巧克力";
       		if(request_subtype!=null){
       			switch(request_subtype) {
       			 case "nama":
       	       		request_subtype="生巧克力";
       	       	  break;
       	       	 case "art":
       	       		request_subtype="藝術巧克力";
       	       	  break;
       	       	 case "bark":
       	       		request_subtype="巴克巧克力";
       	       	  break;
       	     	 default:
	          		// ?
       			}
       		}
       	  break;
       	 case "others":
       		request_type="精緻小點";
       		if(request_subtype!=null){
       			switch(request_subtype) {
       			 case "pastries":
       	       		request_subtype="派&塔";
       	       	  break;
       	       	 case "puffs":
       	       		request_subtype="泡芙";
       	       	  break;
       	       	 case "macarons":
       	       		request_subtype="馬卡龍";
       	       	  break;
       	       	 case "caneles":
       	       		request_subtype="可麗露";
       	       	  break;
       	       	 case "pannacottas":
       	       		request_subtype="鮮果酪";
       	       	  break;
       	     	 default:
	          		// ?
       			}
       		}
       	  break;
       	 case "drinks":
       		request_type="飲品";
       		if(request_subtype!=null){
       			switch(request_subtype) {
      			 case "tea":
      	       		request_subtype="特調茶飲";
      	       	  break;
      	       	 case "latte":
      	       		request_subtype="香濃拿鐵";
      	       	  break;
      	       	 case "coffee":
      	       		request_subtype="經典咖啡";
      	       	  break;
      	       	 case "fruits":
      	       		request_subtype="繽紛水果飲";
      	       	  break;
      	     	 default:
	          		// ?
      			}
       		}
       	  break;
       	 default:
       		$.get("/dessert_shop/product/getAllProduct", {}, function (data) {
           		console.log(data.msg);
           		defaultDisplay(data);
            });
       	}
       	console.log("轉換後:"+request_type);	
     	console.log("轉換後:"+request_subtype);	
  
       	
       	// 要取得商品資訊的API
       	$.get("/dessert_shop/product/getAllProduct", {}, function (data) {
       		console.log(data.msg);
       		productDisplay(data);
//      		console.log(window.location.href);
           		
        });
       	
       
       	var validDSProduct=0;
     // 取得有效特價商品的API,用var儲存data，最後寫function() ,比對product_id，把頁面上id符合的 價格覆蓋
       	$.get("/dessert_shop/dailySpecial/getValidDailySpecialProduct", {}, function (data) {
       		validDSProduct = data.data;
        	console.log("validDSProduct:"+validDSProduct);///???????????沒印出來阿
           	updatePrice(validDSProduct);
           	console.log("優惠商品flag:"+data.flag);
   
        });	
   		
       	function updatePrice(data){
			console.log("updatePrice!!!!!!!!!!!!!!!");       		
       		for(var i = 0 ; i < data.length; i++){
       			console.log(data[i]);
       			let update_id = data[i].product_id;
       			let update_price = data[i].discount_price;
       			let old_price = data[i].product_price;
       			
       			$("#"+update_id).find(".sele-price").html('<span class="regular-price">$'+old_price+'</span> <span class="sale-price">$'+update_price+'</span>');

       			
       		}
      }//updatePrice() 
   		
		       	
       	
       	
         
				     	
	<!--*******  排序功能  ******--> // 語法重複性太高，有空再修改...    
		$(".sorting").on("change", function(){
    		console.log("change sorting!");
    		let sort = $(".sorting").val();
    		console.log(sort);
    		if (sort == 1){
   				$.get("/dessert_shop/product/getAllSortByPurchase", {}, function (data) {
   					console.log("sort purchase");
					$("div#grid div.row").find("div[class='col-lg-3 col-sm-6']").remove();
					$("div#list").find("div[class='single-product product-list']").remove();
					if(request_type == null && request_subtype == null){
						defaultDisplay(data);
					}else{
			     		productDisplay(data);
					}
			     });
    			
    		}else if (sort == 2){
    			$.get("/dessert_shop/product/getAllSortByStar", {}, function (data) {
		     		console.log("sort star");
		     		$("div#grid div.row").find("div[class='col-lg-3 col-sm-6']").remove();
					$("div#list").find("div[class='single-product product-list']").remove();
					if(request_type == null && request_subtype == null){
						defaultDisplay(data);
					}else{
			     		productDisplay(data);
					}
		     	});
    			
    		}else if(sort == 3){
    			$.get("/dessert_shop/product/getAllSortByPrice", {}, function (data) {
		     		console.log("sort price");
		     		$("div#grid div.row").find("div[class='col-lg-3 col-sm-6']").remove();
					$("div#list").find("div[class='single-product product-list']").remove();
					if(request_type == null && request_subtype == null){
						defaultDisplay(data);
					}else{
			     		productDisplay(data);
					}
		     	});
    			
    			
     		}else if (sort == 4){
     			$.get("/dessert_shop/product/getAllSortByCalorie", {}, function (data) {
		     		console.log("sort calorie");
		     		$("div#grid div.row").find("div[class='col-lg-3 col-sm-6']").remove();
					$("div#list").find("div[class='single-product product-list']").remove();
					if(request_type == null && request_subtype == null){
						defaultDisplay(data);
					}else{
			     		productDisplay(data);
					}
			    });
     			
     		}else if(sort == 5){
     			$.get("/dessert_shop/product/getAllSortBySweetness", {}, function (data) {
		     		console.log("sort sweetness");
		     		$("div#grid div.row").find("div[class='col-lg-3 col-sm-6']").remove();
					$("div#list").find("div[class='single-product product-list']").remove();
					if(request_type == null && request_subtype == null){
						defaultDisplay(data);
					}else{
			     		productDisplay(data);
					}
			     });
     			
     		}else if(sort == 0){
     			// 跳回去原始的
     			$.get("/dessert_shop/product/getAllProduct", {}, function (data) {
     	       		console.log("依最新商品");
     	       		$("div#grid div.row").find("div[class='col-lg-3 col-sm-6']").remove();
					$("div#list").find("div[class='single-product product-list']").remove();
					if(request_type == null && request_subtype == null){
						defaultDisplay(data);
					}else{
			     		productDisplay(data);
					}
     	       	});
     		}
   		});  
		// 是不是應該讓排序的條件可以顯示?熱量 甜度 銷售量 看不到
           
        // 讓他在取得api拿到預設的0
       $(window).on("load", function(){
    	   // 圖片等資源載入完成之後
    	   console.log("sorting!");
   			var sort = $(".sorting").val();
    	});
//        var sort = $(".sorting :selected").val();
//    		console.log(sort);

	  

   		let url = location.href.split("/TEA103G2")[0];
   		function productDisplay(data){
   			console.log("productDisplay");
		    
			for(var i = 0 ; i < data.data.length; i++){
	      		// 判斷是否符合該主分類
	  			if((data.data[i].product_subtype == request_subtype && data.data[i].product_type == request_type) | (request_subtype == null && data.data[i].product_type == request_type)){
	  				
	  				console.log("dispaly裡的subtype"+data.data[i].product_subtype);

	  				let product_id = data.data[i].product_id;
					let product_name = data.data[i].product_name;
					let product_subtype = data.data[i].product_subtype;
	  				let product_price = data.data[i].product_price;
	    			let avg_star = data.data[i].total_star/data.data[i].total_review;
	     			let fixed_star = avg_star.toFixed(1);
	     			let image_list = data.data[i].image_url.valueOf();
	//       		let image_list = [data.data[i].image_url]; //此取法為二維陣列
					let product_intro = data.data[i].product_intro;
					let product_available_qty = data.data[i].product_available_qty;
	      				
	     			let product_img1 = url+image_list[0];
	     			let product_img2 = url+image_list[1];
	     	           				
	  				let single_product_grid = `
	      				<div class="col-lg-3 col-sm-6" data->
							<!-- Single Product Start -->
							<div class="single-product" id="${product_id}">
								<div class="product-image">
									<a class="product-thumbnail" href="product-single.html?id=${product_id}"> 
										<img src="${product_img1}" alt="product">										
										<img class="image-hover" src="${product_img2}" alt="product">
									</a>
									<div class="product-action">
										<a href="#收藏網頁" class="action"><i class="lar la-heart"></i></a>
										<a href="javascript:void(0)" class="action compare"><i class="las la-sync"></i></a>
										<a href="#跳出燈箱" class="action search" data-bs-toggle="modal"
									  	 data-bs-target="#quick-view" ><i class="las la-search"></i></a>
										<a href="javascript:void(0)" class="action add-cart"><i class="ion-bag"></i></a>
									</div>
										<div class="product-flag">
										<span class="new">${fixed_star}</span>
									</div>
								</div>
								<div class="product-content">
									<h4 class="product-title">
										<a href="product-single.html?id=${product_id}">${product_name}</a>
									</h4>
									<div class="manufacturer">
										<a href="#">${product_subtype}</a>
									</div>
									<div class="product-price">
										<span class="sele-price">$${product_price}</span>
									</div>
								</div>
							</div>
							<!-- Single Product End -->
						</div>`
	                  
					$("div#grid div.row:last-child").append(single_product_grid); 
						
						
		    		let single_product_list=`
		    			<!-- Single Product Start -->
						<div class="single-product product-list" id="${product_id}">
							<div class="product-image">
								<a class="product-thumbnail" href="product-single.html?id=${product_id}"> 
								<img src="${product_img1}" alt="product">
								<img class="image-hover" src="${product_img2}" alt="product">
								</a>
								<div class="product-action">
									<a href="#" class="action"><i class="lar la-heart"></i></a>
									<a href="#" class="action"><i class="las la-sync"></i></a> 
									<a href="#" class="action search" data-bs-toggle="modal"
										data-bs-target="#quick-view"><i class="las la-search"></i></a>
								</div>
								<div class="product-flag">
									<span class="new">${fixed_star}</span>
								</div>
							</div>
							<div class="product-content">
								<h4 class="product-title">
									<a href="shop-single.html">${product_name}</a>
								</h4>
								<div class="manufacturer">
									<a href="#">${product_subtype}</a>
								</div>
								<div class="product-price">
									<span class="sele-price">$${product_price}</span>
								</div>
								<div class="product-desc">
									<ul>
										${product_intro}
									</ul>
								</div>
								<div class="availability">
									<p>
										現貨數量: <span class="current_qty">${product_available_qty}</span>
									</p>
								</div>
								<div class="cart-btn">
									<a href="javascript:void(0)" class="btn btn-primary btn-hover-dark add-cart"> 加入購物車 </a>
								</div>
							</div>
						</div>
						<!-- Single Product End -->`
						
		    		$("div#list").append(single_product_list); 

						// 更新價格*****************************************************************
						// updatePrice();
	      	
   				}//for迴圈end
	      		
			}
			//等商品渲染完後，把比較商品的比較按鈕上色
			getCompareList();
			  
			  
			  
   		}//productDisplay()
   		
   		
   		

   		
   		

       	
       	
// 商品總覽(不帶任何參數時)
		function defaultDisplay(data){
			console.log("defaultDisplay")
			
			for(var i = 0 ; i < data.data.length; i++){
  				
  				let product_id = data.data[i].product_id;
				let product_name = data.data[i].product_name;
				let product_subtype = data.data[i].product_subtype;
  				let product_price = data.data[i].product_price;
    			let avg_star = data.data[i].total_star/data.data[i].total_review;
     			let fixed_star = avg_star.toFixed(1);
     			let image_list = data.data[i].image_url.valueOf();
//       		let image_list = [data.data[i].image_url]; //此取法為二維陣列
				let product_intro = data.data[i].product_intro;
				let product_available_qty = data.data[i].product_available_qty;
      				
     			let product_img1 = url+image_list[0];
     			let product_img2 = url+image_list[1];
     	           				
  				let single_product_grid = `
      				<div class="col-lg-3 col-sm-6" data->
						<!-- Single Product Start -->
						<div class="single-product" id="${product_id}">
							<div class="product-image">
								<a class="product-thumbnail" href="product-single.html?id=${product_id}"> 
									<img src="${product_img1}" alt="product">										
									<img class="image-hover" src="${product_img2}" alt="product">
								</a>
								<div class="product-action">
									<a href="#收藏網頁" class="action"><i class="lar la-heart"></i></a>
									<a href="#比較網頁" class="action"><i class="las la-sync"></i></a>
									<a href="#" class="action search" data-bs-toggle="modal"
								  	 data-bs-target="#quick-view" ><i class="las la-search"></i></a>
									<a href="javascript:void(0)" class="action add-cart"><i class="ion-bag"></i></a>
								</div>
									<div class="product-flag">
									<span class="new">${fixed_star}</span>
								</div>
							</div>
							<div class="product-content">
								<h4 class="product-title">
									<a href="product-single.html?id=${product_id}">${product_name}</a>
								</h4>
								<div class="manufacturer">
									<a href="#">${product_subtype}</a>
								</div>
								<div class="product-price">
									<span class="sele-price">$${product_price}</span>
								</div>
							</div>
						</div>
						<!-- Single Product End -->
					</div>`
                  
					$("div#grid div.row:last-child").append(single_product_grid); 
					
					
	    		let single_product_list=`
	    			<!-- Single Product Start -->
					<div class="single-product product-list" id="${product_id}">
						<div class="product-image">
							<a class="product-thumbnail" href="product-single.html?id=${product_id}"> 
							<img src="${product_img1}" alt="product">
							<img class="image-hover" src="${product_img2}" alt="product">
							</a>
							<div class="product-action">
								<a href="#" class="action"><i class="lar la-heart"></i></a>
								<a href="#" class="action"><i class="las la-sync"></i></a> 
								<a href="#" class="action search" data-bs-toggle="modal"
									data-bs-target="#quick-view"><i class="las la-search"></i></a>
							</div>
							<div class="product-flag">
								<span class="new">${fixed_star}</span>
							</div>
						</div>
						<div class="product-content">
							<h4 class="product-title">
								<a href="shop-single.html">${product_name}</a>
							</h4>
							<div class="manufacturer">
								<a href="#">${product_subtype}</a>
							</div>
							<div class="product-price">
								<span class="sele-price">$${product_price}</span>
							</div>
							<div class="product-desc">
								<ul>
									${product_intro}
								</ul>
							</div>
							<div class="availability">
								<p>
									現貨數量: <span class="current_qty">${product_available_qty}</span>
								</p>
							</div>
							<div class="cart-btn">
								<a href="javascript:void(0)" class="btn btn-primary btn-hover-dark add-cart"> 加入購物車 </a>
							</div>
						</div>
					</div>
					<!-- Single Product End -->`
					
	    			$("div#list").append(single_product_list); 
      	
				}
		
		}//defaultDisplay
		
   		
   		
   		
   		
   		
   		
   		
   		// 同時取到grid跟list的放大鏡
   		$("body").on("click", "a.search", function(e) {
   			let product_id = $(this).closest(".single-product").attr("id");
   			console.log("quick view");
   			console.log(product_id);
   			$.get("/dessert_shop/product/getOneProduct?id="+product_id, {}, function(data) {
   				console.log("點選後:"+data.data.product_id);
				let product_name = data.data.product_name;
				let product_type = data.data.product_type;
				let product_subtype = data.data.product_subtype;
  				let product_price = data.data.product_price;
  				let total_review = data.data.total_review;
    			let avg_star = data.data.total_star/total_review;
     			let fixed_star = avg_star.toFixed(1);
     			let rating_star = (avg_star/5*100);
     			let image_list = data.data.image_url.valueOf();
				let product_intro = data.data.product_intro;
				let product_ingredient = data.data.product_ingredient;
				let product_available_qty = data.data.product_available_qty;
				
				// quick-view區塊給product_id
				$("#quick-view").attr("data-product_id", product_id);
				
				$("div.quick-view-content .product-name").text(product_name);
				$("div.quick-view-content .reference").html(product_type+":"+"<span>"+product_subtype+"</span>");
				$("div.quick-view-content").find("i[class='fal fa-comment-dots'] span").text("("+total_review+")");
				$("div.quick-view-content ul.shop-rating-content").find("span").text("("+total_review+")");
				$("div.quick-view-content .review-star div.star").attr("style", "width:"+rating_star+"%"); 
				$("div.quick-view-content .sale-price").text("$"+product_price);
				$("div.quick-view-content .product-description ul").html("<li>"+product_intro+"</li>");
				$("div.quick-view-content .product-description ul").append("<li>"+" 成份: "+product_ingredient+"</li>");
				$("#quick-view .new").text(fixed_star);
				
				$("div.quick-view-top .swiper-wrapper").html("");
				$("div[class='product-thumbnail quick-view-thumbs'] .swiper-wrapper").html("");
				
				let product_images=[];
				for(var i = 0 ; i < image_list.length ; i++){
					product_images[i]= url + image_list[i];
					console.log(product_images[i]);
     				let quick_view_image=`
     					<div class="swiper-slide">
							<img src="${product_images[i]}" alt="Product Thumbnail">
						</div>`
					$("div.quick-view-top .swiper-wrapper").append(quick_view_image);
					$("div[class='product-thumbnail quick-view-thumbs'] .swiper-wrapper").append(quick_view_image);
     			} 
     			
     			
   			});
   			
   		});
   		
		
	// 加入購物車	
		$("body").on("click", ".add-cart", function(){
			console.log("加入購物車");
			let product_id = $(this).closest(".single-product").attr("id");
			if(product_id == null){
				product_id = $("#quick-view").attr("data-product_id");
				console.log("product_id為null，quick view product_id:"+product_id);
			}
			console.log("加入購物車的id:"+product_id);
			let single_purchase = $(".purchase_qty").val();
			
			console.log("加入購物車的數量:"+single_purchase);
			
			// API要給id 跟數量 如果頁面沒有數量可以選 設為1
			$.post("/dessert_shop/cart/insertProductIntoCart?product_id="+product_id+"&product_quantity="+single_purchase,{},function(data){
				console.log("加入購物車回傳的flag:"+data.flag);
				// 判斷是否登入
				if(data.flag == false){
					Swal.fire({
		                title: data.msg,
		                text: "請先登入帳號!",
		                icon: "error"
		              }).then(function(){
						 location.href="login.html";
		              });
						
				}else{
					// 已登入的情況下，可即時更新現貨數量
					let product_available_qty = data.data;
					console.log("及時的現貨數量:"+product_available_qty);
					// 操作畫面上的現貨數量
// 					$(this).closest(".availability").find(".current_qty").text(product_available_qty);
// 					$(".current_qty").text(product_available_qty);
					// 一直改不成功
				}
				
			});//$.post
			
			
			$(".purchase_qty").val("1");//清空quick-view裡的數量
			
		});
		
		
		
   		
   	// 分頁功能	

   		
   		
   		

        	
        	
        	
        	
//    });

 
	
    
       
</script>
<script>
	/*******************以下比較列表********************/
	$("body").on("click", "a.compare", function(e) {
		let id = $(this).closest("div[class=single-product]").attr("id")
		console.log($(this))
		if($(this).hasClass("-on")){
			removeCompareList(id)
			$(this).removeClass("-on");
			$(this).css("background-color","#fff");
			$(this).css("color","#000");
			updateCompareNumber()
		}else{
			if(addCompareList(id)){
				console.log("成功加入")
				$(this).css("background-color","#83bc2e");
				$(this).css("color","#fff");
				$(this).addClass("-on");
				updateCompareNumber()
			}else{
				Swal.fire({
					title: "比較列表最多三個商品",
					text: '',
					icon: "error"
				})
				$(this).css("background-color","#fff");
				$(this).css("color","#000");
			}
		}
	})

	function getCompareList(){
		let compareList = JSON.parse(localStorage.getItem("compareList"));
		if(compareList==null){
			compareList=[];
			localStorage.setItem("compareList", JSON.stringify(compareList));
			return;
		}else{
			compareList.forEach(function(item, index, arr) {
				console.log($("#"+item));
				$("#"+item).find("a.compare").addClass("-on");
				$("#"+item).find("a.compare").css("background-color","#83bc2e");
				$("#"+item).find("a.compare").css("color","#fff");
			});
		}
	}


	function addCompareList(product_id){
		let compareList = JSON.parse(localStorage.getItem("compareList"));
		if(compareList==null ) {
			compareList=[product_id];
			localStorage.setItem("compareList", JSON.stringify(compareList));
			return true;
		}else{
			if(compareList.length>=3) return false;
			compareList.push(product_id);
			localStorage.setItem("compareList", JSON.stringify(compareList));
			return true;
		}
	}

	// removeCompareList(3);
	function removeCompareList(product_id){
		let compareList = JSON.parse(localStorage.getItem("compareList"));
		if(compareList==null ) return true;
		compareList.forEach(function(item, index, arr) {
			if(item == product_id) {
				arr.splice(index, 1);
			}
		});
		localStorage.setItem("compareList", JSON.stringify(compareList));
		console.log(compareList);
		return true;
	}

</script>
</body>

</html>